function getQueryVariable(a){for(var b=window.location.search.substring(1),c=b.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if(decodeURIComponent(e[0])==a)return decodeURIComponent(e[1])}console.log("Query variable %s not found",a)}function launchIntoFullscreen(a){a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()}function runTease(a,c){return __awaiter(this,void 0,void 0,function*(){f.set("teaseId",a),$("#exit").click(()=>{rating.show()}),rating=new O($("#rating"));var d=new b(a,$("#tease"));if(yield d.parse(),$("#loading").hide(),1==c){var e=d.loadState(!1);e==StateLoadResult.VersionMismatch&&(console.log("Version mismatch with saved data"),confirm("The tease was updated since your last visit.\nContinuing may result in strange behavior. Do you really want to load your saved state?")&&(e=d.loadState(!0))),e!=StateLoadResult.Ok&&(console.log("Failed to load state."),d.start())}else d.start()})}var rating,__awaiter=this&&this.__awaiter||function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b)).next())})};class a{constructor(){this.children=Array(),this._x=0,this._y=0,this._width=0,this._height=0,this.node=$("<div></div>"),this.node.attr("flashclass",this.constructor.name)}get x(){return this._x}set x(a){this._x=a,this.updateNode()}get y(){return this._y}set y(a){this._y=a,this.updateNode()}get width(){return this._width}set width(a){this._width=a,this.updateNode()}get height(){return this._height}set height(a){this._height=a,this.updateNode()}get parent(){return this._parent}set parent(a){this._parent=a}updateNode(){this.node.css("box-sizing","content-box"),this.node.width(this.width),this.node.height(this.height),this.node.css("left",this.x),this.node.css("top",this.y),this.node.css("position","absolute"),this.node.css("box-sizing","")}render(a){for(var b in this.children)this.children[b].render(this.node);a.append(this.node)}addChild(a){this.children.push(a),a.parent=this}removeChild(a){a.parent=null,a.destroy(),delete this.children[this.children.indexOf(a)]}destroy(){for(var a in this.children)this.children[a].destroy();this.node.remove()}}var StateLoadResult;!function(a){a[a.Ok=0]="Ok",a[a.NoData=1]="NoData",a[a.VersionMismatch=2]="VersionMismatch"}(StateLoadResult||(StateLoadResult={}));class b extends a{constructor(a,b){super(),$(window).resize(a=>{this.width=b.width(),this.height=b.height(),this._currentClip.setBounds(this.bounds)}),this._id=a,this._renderTarget=b,this._actionRegistry=new Array,this.width=b.width(),this.height=b.height()}saveState(){window.localStorage.setItem(`tease-${this._id}`,j.serialize(this._scriptHash))}loadState(a){var b=window.localStorage.getItem(`tease-${this._id}`);if(!b||""==b)return StateLoadResult.NoData;var c=j.deserialize(this._scriptHash,b,a);return c==StateLoadResult.Ok&&this.runAction(j.getCurrentAction().toString(),!1),c}load(){return new Promise((a,b)=>jQuery.get("script?id="+this._id,(b,c,d)=>{console.log("downloaded script successfully"),this._scriptHash=SparkMD5.hash(b),this._script=b,a()}))}loadMeta(){return new Promise((a,b)=>jQuery.get("meta?id="+this._id,b=>{console.log("downloaded metadata successfully"),i.interpretMetainfo(b),i.cacheAction(new e("start")),a()}))}parse(){return __awaiter(this,void 0,void 0,function*(){this._script||(yield this.load(),yield this.loadMeta());var a=N.explode("\n",this._script);for(var b in a){var d=a[b];if(0!=d.length){var e=d.indexOf("#");if(e==-1||e>d.indexOf("("))this.runCommandAsAction(new c(d));else{var f=d.substr(0,e),g=d.substr(e+1);this.addAction(f,g)}}}})}start(){this.runAction("start")}runAction(a,b=true){var d=null,f=null,g=null,h=NaN;if(a instanceof e&&(a=a.toString()),a instanceof c&&(a=a.toString()),f=this.resolveAction(a),console.log("Running action "+f+"..."),"exittease"==f.toString())return window.localStorage.removeItem(`tease-${this._id}`),void rating.show();if(void 0!=this._actionRegistry[f.toString()]){if(d=this._actionRegistry[f.toString()],b&&j.noteActionRun(f),i.cacheAction(f),"{"==d.substr(0,1)){for(g=N.explodeWithParenthesis(";",d.substr(1)),d="mult(",h=0;g.length;)d+="e"+h+":"+g.shift(),h++,g.length&&(d+=",");d+=")"}var k=N.parseParameter(d);return k instanceof c||console.error(this,"Action "+f+" does not contain a valid command."),void this.runCommandAsAction(k)}console.error(this,"Action not found: "+f)}isValidAction(a){return void 0!=this._actionRegistry[a]}runCommandAsAction(a){this.clearCurrentClip(),this._currentClip=a.getCmdObject(),this._currentClip.setViewer(this);var b=a.getInputVars();this.addChild(this._currentClip),this._currentClip.initialize(b,this.bounds),this.render(this._renderTarget),this.saveState()}clearCurrentClip(){null!=this._currentClip&&(this._currentClip.destroy(),this._currentClip.parent==this&&this.removeChild(this._currentClip))}resolveAction(a){var b=null,d=null;return")"==a.substr(-1)?(d=new c(a).loadCmdClip(this),b=d.getAction()):b=new e(a),b}addAction(a,b){this._actionRegistry[a]=b}get bounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}}class c{constructor(a){this._action=a}getCmdObject(){var a=this._action.indexOf("("),b=this._action.substr(0,a),c=d.getCommandClass(b);return c}loadCmdClip(a,b=null){var c=this.getCmdObject(),d=this.getInputVars();return c.setViewer(a),null==b&&(b={x:0,y:0,width:0,height:0}),c.initialize(d,b),c}getInputVars(){var a=this._action.indexOf("("),b=this._action.substr(a+1,this._action.length-a-2);return N.parseParamList(b)}toString(){return this._action}}class d{static getCommandClass(a){switch(a){case"buttons":return new K;case"page":return new M;case"text":return new B;case"pic":return new C;case"mult":return new E;case"yn":return new H;case"set":return new n;case"unset":return new o;case"delay":return new A;case"go":return new G;case"range":return new w;case"dummy":return new m;case"goto":return new p;case"horiz":return new I;case"vert":return new J;case"must":return new q;case"mustnot":return new r;case"numactions":return new s;case"numactionsfrom":return new t;case"random":return new u;case"repeat":return new v;case"repeatadd":return new x;case"repeatdel":return new y;case"repeatset":return new z;case"sound":return new D}return console.log("Invalid command: "+a),new m}}class e{constructor(a){this.toString=(()=>{return this._string}),this._string=a}}class f{static get(a,b=null){return void 0==f._settings[a]?b:f._settings[a]}static set(a,b){f._settings[a]=b}}f._settings=Array();class g{constructor(a){this.url=a}}class h{constructor(a){this.url=a}}class i{static showImage(a,b=null){if(null!=i._loadedImages[a]){console.log("Image "+a+" from cache...");var c=i._loadedImages[a];return a.indexOf("*")>-1&&delete i._loadedImages[a],c}return console.log("Downloading image "+a+" ..."),a="medialocation?folder="+f.get("mediaFolder")+"&id="+a,$.get(a,c=>{i._loadedImages[a]=new g(c),b(c)}),null}static getSound(a,b=null){if(null!=i._loadedSounds[a]){console.log("Sound "+a+" from cache...");var c=i._loadedSounds[a];return a.indexOf("*")>-1&&delete i._loadedSounds[a],c}console.log("Downloading sound "+a+" ..."),a="medialocation?folder="+f.get("mediaFolder")+"&id="+a,$.get(a,c=>{i._loadedSounds[a]=new h(c),b(c)})}static emptyQueue(){i._queue=[]}static queueMedia(a){i._queue.push(a)}static runQueue(){i._queueRunning||(i._queueRunning=!0,i.loadNextQueueItem())}static loadNextQueueItem(a=null){if(window.clearInterval(i._queueIdleTimer),0==i._queue.length)return void(i._queueIdleTimer=window.setInterval(i.loadNextQueueItem,1e3));var b=i._queue.shift();"pic:"==b.substr(0,4)?i.loadImage(b.substr(4)):"sound:"==b.substr(0,6)?i.loadSound(b.substr(6)):i.loadNextQueueItem()}static loadSound(a){if(null!=i._loadedSounds[a])return void i.loadNextQueueItem();var b="medialocation?folder="+f.get("mediaFolder")+"&id="+a;console.log("Preloading "+b+"..."),$.get(b,b=>{var c=document.createElement("audio");c.autoplay=!1,c.preload="auto",c.addEventListener("loadeddata",function(c){i._loadedSounds[a]=new h(b),i._loadedSounds[a].audio=c.target,i.loadNextQueueItem()}),c.src=b})}static loadImage(a){if(null!=i._loadedImages[a])return void i.loadNextQueueItem();var b="medialocation?folder="+f.get("mediaFolder")+"&id="+a;console.log("Preloading "+b+"..."),$.get(b,b=>{var c=document.createElement("img");c.addEventListener("load",function(c){var d=c.target;i._loadedImages[a]=new g(b),i._loadedImages[a].width=d.width,i._loadedImages[a].height=d.height,i.loadNextQueueItem()}),c.src=b})}static cacheAction(a){i.emptyQueue(),i.queueActionMedia(a);for(var b in i._execTree[a.toString()])i.queueActionMedia(i._execTree[a.toString()][b]);i.runQueue()}static queueActionMedia(a){for(var b in i._mediaList[a.toString()])i.queueMedia(i._mediaList[a.toString()][b])}static interpretMetainfo(a){var b=null,c=NaN,d=null,g=null,h=null;console.log("MetaInfo loaded.");var j=a.split("\n"),k=j[0];j[1],j[2];f.set("mediaFolder",k+"/"+f.get("teaseId")),j=j.slice(3);var l=1;for(b in j)if("=============================="==j[b])l=2;else if(l>0){c=j[b].indexOf("#"),d=new e(j[b].substr(0,c)),g=j[b].substr(c+1).split(",");for(h in g)1==l?i.addMediaInstance(d,g[h]):i.addExecRelation(d,new e(g[h]))}}static addExecRelation(a,b){null==i._execTree[a.toString()]&&(i._execTree[a.toString()]=new Array),i._execTree[a.toString()].push(b)}static addMediaInstance(a,b){null==i._mediaList[a.toString()]&&(i._mediaList[a.toString()]=new Array),i._mediaList[a.toString()].push(b)}}i._mediaList=new Array,i._execTree=new Array,i._queue=new Array,i._queueRunning=!1,i._loadedImages=new Array,i._loadedSounds=new Array;class j{static serialize(a){var b={version:1,hash:a,actionSet:j._actionSet,currentAction:j._currentAction.toString(),actionRunCounter:j._actionRunCounter,actionFirstRun:j._actionFirstRun,actionLastRun:j._actionLastRun,actionRepeat:j._actionRepeat,actionNumActions:j._actionNumActions,actionMustNot:j._actionMustNot,actionMust:j._actionMust,actionNumActionsFrom:j._actionNumActionsFrom};return JSON.stringify(b)}static deserialize(a,b,c){var d=JSON.parse(b);return null==d?StateLoadResult.NoData:c||d.hash==a?(j._actionSet=d.actionSet,j._currentAction=new e(d.currentAction),j._actionRunCounter=d.actionRunCounter,j._actionFirstRun=d.actionFirstRun,j._actionLastRun=d.actionLastRun,j._actionRepeat=d.actionRepeat,j._actionNumActions=d.actionNumActions,j._actionMustNot=d.actionMustNot,j._actionMust=d.actionMust,j._actionNumActionsFrom=d.actionNumActionsFrom,StateLoadResult.Ok):StateLoadResult.VersionMismatch}static setAction(a){void 0==j._actionSet[a.toString()]&&(j._actionSet[a.toString()]=0),j._actionSet[a.toString()]=j._actionSet[a.toString()]+1}static unsetAction(a){j._actionSet[a.toString()]=0}static noteActionRun(a){j._currentAction=a,j._actionRunCounter++,j.setAction(a),void 0==j._actionFirstRun[a.toString()]&&(j._actionFirstRun[a.toString()]=j._actionRunCounter),j._actionLastRun[a.toString()]=j._actionRunCounter}static checkRelations(a){var b=null,c=NaN;if(j.isSetAction(a))return console.log(a+" relation unfulfilled: action is set"),!1;for(b in j._actionMust[a.toString()])if(!j.isSetAction(j._actionMust[a.toString()][b]))return console.log(a+" relation unfulfilled: must "+j._actionMust[a.toString()][b]),!1;for(b in j._actionMustNot[a.toString()])if(j.isSetAction(j._actionMustNot[a.toString()][b]))return console.log(a+" relation unfulfilled: mustnot "+j._actionMustNot[a.toString()][b]),!1;if(void 0!=j._actionNumActions[a.toString()]&&j._actionRunCounter<j._actionNumActions[a.toString()])return console.log(a+" relation unfulfilled: numactions > "+j._actionNumActions[a.toString()]+" (but is "+j._actionRunCounter+")"),!1;for(b in j._actionNumActionsFrom[a.toString()])if(c=j._actionRunCounter-j._actionFirstRun[j._actionNumActionsFrom[a.toString()][b].since],c<j._actionNumActionsFrom[a.toString()][b].num)return console.log(a+" relation unfulfilled: numactionsfrom "+j._actionNumActionsFrom[a.toString()][b].since+" > "+j._actionNumActionsFrom[a.toString()][b].num+" (but is "+c+")"),!1;return console.log(a+" all relations fulfilled"),!0}static addMustNotRelation(a,b){void 0==j._actionMustNot[a.toString()]&&(j._actionMustNot[a.toString()]=new Array),j._actionMustNot[a.toString()].push(b)}static addMustRelation(a,b){void 0==j._actionMust[a.toString()]&&(j._actionMust[a.toString()]=new Array),j._actionMust[a.toString()].push(b)}static addNumActionsFromRelation(a,b,c){void 0==j._actionNumActionsFrom[a.toString()]&&(j._actionNumActionsFrom[a.toString()]=new Array),j._actionNumActionsFrom[a.toString()].push({num:c,since:b})}static addNumActionsRelation(a,b){j._actionNumActions[a.toString()]=b}static getCurrentAction(){return j._currentAction}static addRepeat(a,b){void 0==j._actionRepeat[a.toString()]&&(j._actionRepeat[a.toString()]=1),j._actionRepeat[a.toString()]=j._actionRepeat[a.toString()]+b}static setRepeat(a,b){j._actionRepeat[a.toString()]=b}static delRepeat(a,b){void 0==j._actionRepeat[a.toString()]&&(j._actionRepeat[a.toString()]=1),j._actionRepeat[a.toString()]=j._actionRepeat[a.toString()]-b}static isSetAction(a){return void 0==j._actionRepeat[a.toString()]&&(j._actionRepeat[a.toString()]=1),void 0==j._actionSet[a.toString()]&&(j._actionSet[a.toString()]=0),j._actionSet[a.toString()]>=j._actionRepeat[a.toString()]}}j._actionSet=new Array,j._actionRunCounter=0,j._actionFirstRun=new Array,j._actionLastRun=new Array,j._actionRepeat=new Array,j._actionNumActions=new Array,j._actionMustNot=new Array,j._actionMust=new Array,j._actionNumActionsFrom=new Array;class k extends a{initialize(a,b){this.bounds=b}setBounds(a){this.bounds=a,this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height}setViewer(a){this.viewer=a}}class l extends k{render(a){}}class m extends l{}class n extends l{initialize(a,b){for(var c=0;a["action"+c]instanceof e;c++)j.setAction(a["action"+c])}}class o extends l{initialize(a,b){for(var c=0;a["action"+c]instanceof e;c++)j.unsetAction(a["action"+c])}}class p extends l{initialize(a,b){this.viewer.runAction(a.target)}}class q extends l{initialize(a,b){for(var c=0;a["action"+c]instanceof e;c++)j.addMustRelation(a.self,a["action"+c])}}class r extends l{initialize(a,b){for(var c=0;a["action"+c]instanceof e;c++)j.addMustNotRelation(a.self,a["action"+c])}}class s extends l{initialize(a,b){j.addNumActionsRelation(a.self,a.count)}}class t extends l{initialize(a,b){j.addNumActionsFromRelation(a.self,a.since,a.count)}}class u extends l{initialize(a,b){this._result=Math.floor(Math.random()*(a.max-a.min))+a.min,console.log("Random number between "+a.min+" and "+a.max+": "+this._result)}getResult(){return this._result}}class v extends l{initialize(a,b){void 0!=a.max?this._total=Math.floor(Math.random()*(a.max-a.count))+a.count:this._total=a.count,this._targetAction=a.target}getAction(){var a=j.getCurrentAction(),b=a.toString();return void 0==v._repeats[b]&&(v._repeats[b]=0),v._repeats[b]<this._total?(v._repeats[b]=v._repeats[b]+1,console.log("Repeating action ("+v._repeats[b]+"/"+this._total+")..."),a):(v._repeats[b]=0,this.viewer.resolveAction(this._targetAction.toString()))}}v._repeats=new Array;class w extends l{initialize(a,b){var c=null;this._validActions=new Array;for(var d=void 0!=a.prefix?a.prefix:"",f=a.from;f<=a.to;f++)c=new e(d+f.toString()),this.viewer.isValidAction(c.toString())&&j.checkRelations(c)&&this._validActions.push(c)}getAction(){if(null==this._validActions||0==this._validActions.length)return console.error("Range failed: All actions set!"),null;var a=Math.floor(Math.random()*this._validActions.length);return this._validActions[a]}}class x extends l{initialize(a,b){j.addRepeat(a.target,a.count)}}class y extends l{initialize(a,b){j.delRepeat(a.target,a.count)}}class z extends l{initialize(a,b){j.setRepeat(a.target,a.count)}}class A extends k{constructor(){super(...arguments),this.CLOCKTEMPLATE=`<div>
  <style>
    .wrapper {
      background:#E89E9E;
      width:$SIZE$px;
      height:$SIZE$px;
      position:relative;
      margin:4px auto;    
      border:1px solid #B85959;
      border-radius:50%;
    }  
    
    .pie {
      width:50%;
      height:100%;
      position:absolute;
      background-color:#B85959;
      transform-origin: 100% 50%;
      border:0px solid rgba(0,0,0,0.4);
    }
    
    .spinner {
      border-radius:100% 0 0 100% / 50% 0 0 50%;
      z-index:200;
      border-right:none;            
      animation: rota $SECONDS$s linear 1;
      animation-fill-mode:forwards;
    }
    
    .filler {
      border-radius:0 100% 100% 0 / 0 50% 50% 0;
      z-index:100;
      border-left:none;
      animation:mask $SECONDS$s steps(1,end) 1 reverse;
      animation-fill-mode:forwards;
      left:50%;
      opacity:0;
    }
    
    .mask {
      width:50%;
      height:100%;
      position:absolute;
      z-index:300;      
      opacity:1;
      background:inherit;
      border-radius:100% 0 0 100% / 50% 0 0 50%;
      animation:mask $SECONDS$s steps(1,end) 1;
      animation-fill-mode:forwards;
    }
    
    @keyframes rota {
      0% { transform:rotate(0deg); }
      100% { transform:rotate(360deg);}
    }
    
    @keyframes mask {
      0%        { opacity: 1; }
      50%, 100% { opacity: 0; }
    }
    
    .pietext {
      position:relative;      
      z-index:500;
      height:100%;
    }
    
    .pietext p {      
      position:absolute;
      top:60%;
      transform:translate(-50%,-50%);
      margin:0;
      left:50%;
      color:white;
      font-weight:bold;
    }
  </style>
  <div class="wrapper">
    <div class="pie spinner"></div>
    <div class="pie filler"></div>
    <div class="mask"></div>    
    <div class="pietext"><p></p></div>
  </div>
</div>`,this.UNKNOWNTEMPLATE=`<div>
  <style>
    .wrapper {
      background:#E89E9E;
      width:$SIZE$px;
      height:$SIZE$px;
      position:relative;
      margin:4px auto;    
      border:1px solid #B85959;
      border-radius:50%;
    }  
    
    .pie {
      width:50%;
      height:100%;
      position:absolute;
      background-color:#B85959;
      transform-origin: 100% 50%;
    }
    
    .spinner {
      border-radius:100% 0 0 100% / 50% 0 0 50%;
      z-index:200;
      border-right:none;           
      transform:rotate(35deg);     
    }
    
    .filler {
      border-radius:0 100% 100% 0 / 0 50% 50% 0;
      z-index:100;
      border-left:none;
      left:50%;
      opacity:0;
    }
    
    .mask {
      width:50%;
      height:100%;
      position:absolute;
      z-index:300;      
      opacity:1;
      background:inherit;
      border-radius:100% 0 0 100% / 50% 0 0 50%;
    }
        
    .pietext {
      position:relative;      
      z-index:500;
      height:100%;
    }
    
    .pietext p {      
      position:absolute;
      top:50%;
      transform:translate(-50%,-50%);
      margin:0;
      left:50%;
      color:white;
      font-weight:bold;
      font-size:90px;
      font-family:serif;
    }
    
    .fgpie {
      background-color:white;
      z-index:450;
      position:absolute;
      width:100%;
      height:100%;
      border-radius:50%;
      opacity:0;
      animation:mask 500ms ease infinite ; 
      animation-direction: alternate;
    }
    
    @keyframes mask {
      0%        { opacity: 0.5; }
      50%, 100% { opacity: 0; }
    }
  </style>
  <div class="wrapper">
    <div class="pie spinner"></div>
    <div class="pie filler"></div>
    <div class="mask"></div>    
    <div class="fgpie"></div>  
    <div class="pietext"><p>?</p></div>
  </div>
</div>`}initialize(a,b){if(super.initialize(a,b),a.time instanceof c){var d=a.time.loadCmdClip(this.viewer);a.time=d.getResult()}f.get("DEBUG",!1)&&(a.style="normal",a.time=2);var e=(new Date).getTime(),g=1e3*a.time,h=e+g;if("secret"==a.style){var i=Math.min(b.width,b.height,100),j=$(this.UNKNOWNTEMPLATE.split("$SIZE$").join(i.toString()));this.node.append(j)}else if("hidden"==a.style)console.log("Hidden delay: "+a.time+" seconds");else{var i=Math.min(b.width,b.height,100),j=$(this.CLOCKTEMPLATE.split("$SECONDS$").join(a.time).split("$SIZE$").join(i.toString()));this._remainingTime=j.find(".pietext>p"),this.node.append(j)}this._timer=window.setInterval(()=>{var b=NaN,c=NaN;if(this._destroyed)return void window.clearInterval(this._timer);var d=h-(new Date).getTime(),e=Math.min(Math.ceil(400*(1-d/g)),400);"secret"!=a.style&&"hidden"!=a.style&&(b=Math.ceil(d/1e3),b>60?(c=Math.floor(b/60),b%=60,b<10?this._remainingTime.text(c+":0"+b):this._remainingTime.text(c+":"+b)):this._remainingTime.text(b.toString())),400==e&&(window.clearInterval(this._timer),this.viewer.runAction(a.target))},100),this.setBounds(b)}destroy(){this._destroyed=!0,super.destroy()}}class B extends k{initialize(a,b){super.initialize(a,b),this._textField=$("<p></p>");var c=$(a.text);c.find("font").attr("size",(a,b)=>{return Number(b)/5}),c.find("font").attr("face","");var d=/(https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*))/gi;c.each(function(){$(this).html($(this).html().replace(d,'<a href="$1" target="_blank">$1</a>'))}),this._textField.html($("<div>").append(c).html()),this.node.append(this._textField),this.setBounds(b)}}class C extends k{initialize(a,b){super.initialize(a,b),void 0==a.id&&(a.id="");var c=i.showImage(a.id,a=>this.createImage(a,0,0));null!=c&&this.createImage(c.url,c.width,c.height)}createImage(a,b,c){this._img=$("<img />"),this._img.css("position","absolute"),0!=b||0!=c?(this._imgwidth=b,this._imgheight=c,this.setBounds(this.bounds)):(console.log("image was not preloaded"),this._img.load(()=>{this._imgwidth=this._img.width(),this._imgheight=this._img.height(),this.setBounds(this.bounds)})),this._img.attr("src",a),this.node.append(this._img)}setBounds(a){if(super.setBounds(a),null!=this._img){let b=Math.min(a.width/this._imgwidth,a.height/this._imgheight);this._img.width(this._imgwidth*b),this._img.height(this._imgheight*b),this._img.css("left",(a.width-this._img.width())/2+a.x),this._img.css("top",(a.height-this._img.height())/2+a.y)}}}class D extends l{initialize(a,b){void 0==a.id&&(a.id=""),void 0==a.loops&&(a.loops=1);var c=i.getSound(a.id,a=>this.createElement(a));null!=c&&(this._sound=c.audio,this._sound.play(),this.node.append(this._sound))}createElement(a){this._sound=new Audio(a),this._sound.play(),this.node.append(this._sound)}destroy(){this._sound&&!this._sound.paused&&this._sound.pause()}}class E extends k{constructor(){super(...arguments),this._elements=new Array}initialize(a,b){super.initialize(a,b);for(var d=0;a["e"+d]instanceof c;d++)this._elements[d]=a["e"+d].loadCmdClip(this.viewer,b),this.addChild(this._elements[d]);this.setBounds(b)}destroy(){for(var a in this._elements)this._elements[a].destroy();super.destroy()}setBounds(a){super.setBounds(a);var b=a;b.x=0,b.y=0;for(var c in this._elements)this._elements[c].setBounds(b)}}class F extends a{constructor(a){super(),this.node=$("<button>"+a+"</button>"),this.node.css("position","absolute")}addClickHandler(a){this.node.click(b=>a(this))}}class G extends k{initialize(a,b){super.initialize(a,b),this._button=new F("Continue"),this._button.addClickHandler(b=>{this.viewer.runAction(a.target)}),this.addChild(this._button),this.setBounds(this.bounds)}setBounds(a){var b=a.width-20,c=25;super.setBounds(a),this._button.y=10,this._button.width=b,this._button.height=c,this._button.x=a.width/2-this._button.width/2}}class H extends k{initialize(a,b){super.initialize(a,b),this._yesButton=new F("YES"),this._yesButton.addClickHandler(b=>{this.viewer.runAction(a.yes.toString())}),this.addChild(this._yesButton),this._noButton=new F("NO"),this._noButton.addClickHandler(b=>{this.viewer.runAction(a.no.toString())}),this.addChild(this._noButton),this.setBounds(this.bounds)}setBounds(a){var b=a.width-20,c=25;super.setBounds(a),this._yesButton.y=10,this._yesButton.width=b,this._yesButton.height=c,this._yesButton.x=a.width/2-this._yesButton.width/2,this._noButton.y=45,this._noButton.width=b,this._noButton.height=c,this._noButton.x=a.width/2-this._noButton.width/2}}class I extends k{constructor(){super(...arguments),this._elements=new Array}initialize(a,b){super.initialize(a,b);for(var d=0;a["e"+d]instanceof c;d++)this._elements[d]=a["e"+d].loadCmdClip(this.viewer,this.calculateElementBounds(b,d)),this.addChild(this._elements[d]);this.setBounds(b)}setBounds(a){super.setBounds(a);for(var b in this._elements)this._elements[b].setBounds(this.calculateElementBounds(a,Number(b)))}destroy(){for(var a in this._elements)this._elements[a].destroy()}calculateElementBounds(a,b){var c=a.width/this._elements.length;return{x:c*b,y:0,width:c,height:a.height}}}class J extends I{calculateElementBounds(a,b){var c=a.height/this._elements.length;return{x:0,y:c*b,width:a.width,height:c}}}class K extends k{constructor(){super(...arguments),this._buttonCaps=new Array,this._buttons=new Array}initialize(a,b){super.initialize(a,b);for(var c=null,d=0;null!=a["target"+d];d++)c=a["cap"+d]?a["cap"+d]:d.toString(),this.addButton(d,a["target"+d],c);this.setBounds(b)}addButton(a,b,c){this._buttons[a]=new F(c),this._buttons[a].addClickHandler(a=>{this.viewer.runAction(b.toString())}),this.addChild(this._buttons[a])}calculateButtonBounds(a,b){var c=a.width-20,d=25;return{x:a.width/2-c/2,y:35*b,width:c,height:d}}setBounds(a){super.setBounds(a);for(var b in this._buttons){var c=this.calculateButtonBounds(a,Number(b));this._buttons[b].x=c.x,this._buttons[b].y=c.y,this._buttons[b].width=c.width,this._buttons[b].height=c.height}}}class L extends k{constructor(){super(),this.node.addClass("splitView")}}class M extends k{initialize(a,b){if(super.initialize(a,b),(a.instruc instanceof c||a.action instanceof c)&&(this._splitView=new L,this.addChild(this._splitView),this.positionSidebar(b)),a.text instanceof c)this._textClip=a.text.loadCmdClip(this.viewer,"text",this.calculateTextBounds(b)),this.addChild(this._textClip);else if("String"==a.text.constructor.name){var d=new c("text(text:'"+a.text.split("'").join("\\'")+"')");this._textClip=d.loadCmdClip(this.viewer,this.calculateTextBounds(b)),this.addChild(this._textClip)}if(a.media instanceof c&&(this._mediaClip=a.media.loadCmdClip(this.viewer,this.calculateMediaBounds(b)),this.addChild(this._mediaClip)),a.instruc instanceof c&&(this._instrucClip=a.instruc.loadCmdClip(this.viewer,this.calculateInstrucBounds(b)),this.addChild(this._instrucClip)),a.action instanceof c&&(this._actionClip=a.action.loadCmdClip(this.viewer,this.calculateActionBounds(b)),this.addChild(this._actionClip)),a.hidden instanceof c&&(this._hiddenClip=a.hidden.loadCmdClip(this.viewer,{})),this.setBounds(b),null==this._splitView&&null==this._actionClip&&null==this._hiddenClip){this._splitView=new L,this.addChild(this._splitView),this.positionSidebar(b);var e=new c("buttons(target0:'exittease',cap0:'Exit Tease')");this._actionClip=e.loadCmdClip(this.viewer,this.calculateActionBounds(b)),this.addChild(this._actionClip)}}setBounds(a){null!=this._splitView&&this.positionSidebar(a),null!=this._textClip&&this._textClip.setBounds(this.calculateTextBounds(a)),null!=this._mediaClip&&this._mediaClip.setBounds(this.calculateMediaBounds(a)),null!=this._instrucClip&&this._instrucClip.setBounds(this.calculateInstrucBounds(a)),null!=this._actionClip&&this._actionClip.setBounds(this.calculateActionBounds(a)),super.setBounds(a)}destroy(){null!=this._hiddenClip&&(this._hiddenClip.destroy(),this._hiddenClip=null),super.destroy()}calculateTextBounds(a){var b=null!=this._splitView?Number(a.width-150):Number(a.width);return{x:a.x,y:a.y+.7*a.height,width:b,height:.3*a.height}}calculateInstrucBounds(a){return{x:a.x+a.width-150,y:a.y,width:150,height:.5*a.height}}calculateMediaBounds(a){var b=null!=this._splitView?Number(a.width-150):Number(a.width);return{x:a.x,y:a.y,width:b,height:.7*a.height}}calculateActionBounds(a){return{x:a.x+a.width-150,y:a.y+.5*a.height,width:150,height:.5*a.height}}positionSidebar(a){this._splitView.x=a.x+a.width-150,this._splitView.y=a.y,this._splitView.width=150,this._splitView.height=a.height}}class N{static explode(a,b){var c=NaN,d=null,e=new Array;if(null==a)return[];if(null==b)return[];for(var f=0;f<b.length&&(c=b.indexOf(a,f),c!=-1);)d=b.slice(f,c),e.push(d),f=c+1;return e.length<1?e.push(b):e.push(b.slice(f,b.length)),e}static explodeWithParenthesis(a,b){var c=null;if(null==b)return[];for(var d=new Array,e="",f="",g=0,h=0,i=0,j=0;j<b.length;j++){switch(e=b.charAt(j),g){case 0:"'"==e?g=1:'"'==e?g=2:"("==e?h++:")"==e?h--:e==a&&0==h&&(c=b.slice(i,j),d.push(c),i=j+1);break;case 1:"'"==e&&"\\"!=f&&(g=0);break;case 2:'"'==e&&"\\"!=f&&(g=0)}f=e}return d.length<1?d.push(b):d.push(b.slice(i,b.length)),d}static parseParameter(a){return"'"==a.substr(0,1)||'"'==a.substr(0,1)?N.parseString(a):"#"==a.substr(-1)?new e(a.substr(0,a.length-1)):"hrs"==a.substr(-3)||"min"==a.substr(-3)||"sec"==a.substr(-3)?N.parseTime(a):isNaN(parseInt(a))?a.indexOf("(")&&")"==a.substr(-1)?new c(a):a:parseInt(a)}static parseParamList(a){var b=null,c=null,d=NaN,e=null,f=null,g=N.explodeWithParenthesis(",",a),h=new Array;for(b in g)c=g[b],d=c.indexOf(":"),e=c.substr(0,d),f=c.substr(d+1),h[e]=N.parseParameter(f);return h}static parseString(a){return a=a.substr(1,a.length-2),a=a.split("\\'").join("'")}static parseTime(a){var b=a.substr(-3),c=parseInt(a.substr(0,a.length-3));return"hrs"==b?3600*c:"min"==b?60*c:c}}class O{constructor(a){this._target=a,this.render(),this._target.hide()}show(){this._target.show(1)}render(){var a=$("<div></div>");a.append("<p>Please rate this tease.</p>");for(var b=this,c=1;c<=5;c++){var d=$(`<img src="images/ustar.png" data-id="${c}" title="${c} Star${c>1?"s":""}" />`);d.mouseenter(function(c){b.highlight(a,Number($(c.target).attr("data-id")),!0)}),d.mouseout(function(c){b.highlight(a,Number($(c.target).attr("data-id")),!1)}),d.click(function(a){b.submit(Number($(a.target).attr("data-id")))}),a.append(d)}a.append('<p><a href="/">Go Back.</a></p>'),this._target.append(a)}highlight(a,b,c){for(var d=a.find("img"),e=0;e<b;e++)$(d[e]).attr("src",c?"images/star.png":"images/ustar.png")}submit(a){$.ajax({url:`vote?id=${f.get("teaseId")}&vote=${a}`,type:"GET",success:function(a){location.href="/"}})}}$().ready(()=>runTease(Number(getQueryVariable("id")),Number(getQueryVariable("resume"))));