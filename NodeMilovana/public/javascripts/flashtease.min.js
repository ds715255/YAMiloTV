function getQueryVariable(a){for(var b=window.location.search.substring(1),c=b.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if(decodeURIComponent(e[0])==a)return decodeURIComponent(e[1])}console.log("Query variable %s not found",a)}function launchIntoFullscreen(a){a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()}function runTease(a){return __awaiter(this,void 0,void 0,function*(){f.set("teaseId",a),$("#exit").click(()=>{rating.show()}),rating=new M($("#rating"));var c=new b(a,$("#tease"));yield c.parse(),$("#loading").hide(),c.start()})}var rating,__awaiter=this&&this.__awaiter||function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b)).next())})};class a{constructor(){this.children=Array(),this._x=0,this._y=0,this._width=0,this._height=0,this.node=$("<div></div>"),this.node.attr("flashclass",this.constructor.name)}get x(){return this._x}set x(a){this._x=a,this.updateNode()}get y(){return this._y}set y(a){this._y=a,this.updateNode()}get width(){return this._width}set width(a){this._width=a,this.updateNode()}get height(){return this._height}set height(a){this._height=a,this.updateNode()}get parent(){return this._parent}set parent(a){this._parent=a}updateNode(){this.node.width(this.width),this.node.height(this.height),this.node.css("left",this.x),this.node.css("top",this.y),this.node.css("position","absolute")}render(a){for(var b in this.children)this.children[b].render(this.node);a.append(this.node)}addChild(a){this.children.push(a),a.parent=this}removeChild(a){a.parent=null,a.destroy(),delete this.children[this.children.indexOf(a)]}destroy(){for(var a in this.children)this.children[a].destroy();this.node.remove()}}class b extends a{constructor(a,b){super(),$(window).resize(a=>{this.width=b.width(),this.height=b.height(),this._currentClip.setBounds(this.bounds)}),this._id=a,this._renderTarget=b,this._actionRegistry=new Array,this.width=b.width(),this.height=b.height()}load(){return new Promise((a,b)=>jQuery.get("script?id="+this._id,b=>{console.log("downloaded script successfully"),this._script=b,a()}))}loadMeta(){return new Promise((a,b)=>jQuery.get("meta?id="+this._id,b=>{console.log("downloaded metadata successfully"),g.interpretMetainfo(b),g.cacheAction(new e("start")),a()}))}parse(){return __awaiter(this,void 0,void 0,function*(){this._script||(yield this.load(),yield this.loadMeta());var a=L.explode("\n",this._script);for(var b in a){var d=a[b];if(0!=d.length){var e=d.indexOf("#");if(e==-1||e>d.indexOf("("))this.runCommandAsAction(new c(d));else{var f=d.substr(0,e),g=d.substr(e+1);this.addAction(f,g)}}}})}start(){this.runAction("start")}runAction(a){var b=null,d=null,f=null,i=NaN;if(a instanceof e&&(a=a.toString()),a instanceof c&&(a=a.toString()),d=this.resolveAction(a),console.log("Running action "+d+"..."),"exittease"==d.toString())return void rating.show();if(void 0!=this._actionRegistry[d.toString()]){if(b=this._actionRegistry[d.toString()],h.noteActionRun(d),g.cacheAction(d),"{"==b.substr(0,1)){for(f=L.explodeWithParenthesis(";",b.substr(1)),b="mult(",i=0;f.length;)b+="e"+i+":"+f.shift(),i++,f.length&&(b+=",");b+=")"}var j=L.parseParameter(b);return j instanceof c||console.error(this,"Action "+d+" does not contain a valid command."),void this.runCommandAsAction(j)}console.error(this,"Action not found: "+d)}isValidAction(a){return void 0!=this._actionRegistry[a]}runCommandAsAction(a){this.clearCurrentClip(),this._currentClip=a.getCmdObject(),this._currentClip.setViewer(this);var b=a.getInputVars();this.addChild(this._currentClip),this._currentClip.initialize(b,this.bounds),this.render(this._renderTarget)}clearCurrentClip(){null!=this._currentClip&&(this._currentClip.destroy(),this._currentClip.parent==this&&this.removeChild(this._currentClip))}resolveAction(a){var b=null,d=null;return")"==a.substr(-1)?(d=new c(a).loadCmdClip(this),b=d.getAction()):b=new e(a),b}addAction(a,b){this._actionRegistry[a]=b}get bounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}}class c{constructor(a){this._action=a}getCmdObject(){var a=this._action.indexOf("("),b=this._action.substr(0,a),c=d.getCommandClass(b);return c}loadCmdClip(a,b=null){var c=this.getCmdObject(),d=this.getInputVars();return c.setViewer(a),null==b&&(b={x:0,y:0,width:0,height:0}),c.initialize(d,b),c}getInputVars(){var a=this._action.indexOf("("),b=this._action.substr(a+1,this._action.length-a-2);return L.parseParamList(b)}toString(){return this._action}}class d{static getCommandClass(a){switch(a){case"buttons":return new I;case"page":return new K;case"text":return new z;case"pic":return new A;case"mult":return new C;case"yn":return new F;case"set":return new l;case"unset":return new m;case"delay":return new y;case"go":return new E;case"range":return new u;case"dummy":return new k;case"goto":return new n;case"horiz":return new G;case"vert":return new H;case"must":return new o;case"mustnot":return new p;case"numactions":return new q;case"numactionsfrom":return new r;case"random":return new s;case"repeat":return new t;case"repeatadd":return new v;case"repeatdel":return new w;case"repeatset":return new x;case"sound":return new B}return console.log("Invalid command: "+a),new k}}class e{constructor(a){this.toString=(()=>{return this._string}),this._string=a}}class f{static get(a,b=null){return void 0==f._settings[a]?b:f._settings[a]}static set(a,b){f._settings[a]=b}}f._settings=Array();class g{static showImage(a,b=null){if(null!=g._loadedImages[a]){console.log("Image "+a+" from cache...");var c=g._loadedImages[a];return a.indexOf("*")>-1&&delete g._loadedImages[a],c}return console.log("Downloading image "+a+" ..."),a="medialocation?folder="+f.get("mediaFolder")+"&id="+a,$.get(a,c=>{g._loadedImages[a]=c,b(c)}),null}static getSound(a,b=null){if(null!=g._loadedSounds[a]){console.log("Image "+a+" from cache...");var c=g._loadedSounds[a];return a.indexOf("*")>-1&&delete g._loadedSounds[a],c}console.log("Downloading sound "+a+" ..."),a="medialocation?folder="+f.get("mediaFolder")+"&id="+a,$.get(a,c=>{g._loadedSounds[a]=c,b(c)})}static emptyQueue(){g._queue=[]}static queueMedia(a){g._queue.push(a)}static runQueue(){g._queueRunning||(g._queueRunning=!0,g.loadNextQueueItem())}static loadNextQueueItem(a=null){if(window.clearInterval(g._queueIdleTimer),0==g._queue.length)return void(g._queueIdleTimer=window.setInterval(g.loadNextQueueItem,1e3));var b=g._queue.shift();"pic:"==b.substr(0,4)?g.loadImage(b.substr(4)):"sound:"==b.substr(0,6)?g.loadSound(b.substr(6)):g.loadNextQueueItem()}static loadSound(a){if(null!=g._loadedSounds[a])return void g.loadNextQueueItem();var b="medialocation?folder="+f.get("mediaFolder")+"&id="+a;console.log("Preloading "+b+"..."),$.get(b,b=>{var c=$("<img />");c.load(c=>{g._loadedSounds[a]=b,g.loadNextQueueItem()}),c.attr("src",b)})}static loadImage(a){if(null!=g._loadedImages[a])return void g.loadNextQueueItem();var b="medialocation?folder="+f.get("mediaFolder")+"&id="+a;console.log("Preloading "+b+"..."),$.get(b,b=>{var c=$("<img />");c.load(c=>{g._loadedImages[a]=b,g.loadNextQueueItem()}),c.attr("src",b)})}static cacheAction(a){g.emptyQueue(),g.queueActionMedia(a);for(var b in g._execTree[a.toString()])g.queueActionMedia(g._execTree[a.toString()][b]);g.runQueue()}static queueActionMedia(a){for(var b in g._mediaList[a.toString()])g.queueMedia(g._mediaList[a.toString()][b])}static interpretMetainfo(a){var b=null,c=NaN,d=null,h=null,i=null;console.log("MetaInfo loaded.");var j=a.split("\n"),k=j[0];j[1],j[2];f.set("mediaFolder",k+"/"+f.get("teaseId")),j=j.slice(3);var l=1;for(b in j)if("=============================="==j[b])l=2;else if(l>0){c=j[b].indexOf("#"),d=new e(j[b].substr(0,c)),h=j[b].substr(c+1).split(",");for(i in h)1==l?g.addMediaInstance(d,h[i]):g.addExecRelation(d,new e(h[i]))}}static addExecRelation(a,b){null==g._execTree[a.toString()]&&(g._execTree[a.toString()]=new Array),g._execTree[a.toString()].push(b)}static addMediaInstance(a,b){null==g._mediaList[a.toString()]&&(g._mediaList[a.toString()]=new Array),g._mediaList[a.toString()].push(b)}}g._mediaList=new Array,g._execTree=new Array,g._queue=new Array,g._queueRunning=!1,g._loadedImages=new Array,g._loadedSounds=new Array;class h{static setAction(a){void 0==h._actionSet[a.toString()]&&(h._actionSet[a.toString()]=0),h._actionSet[a.toString()]=h._actionSet[a.toString()]+1}static unsetAction(a){h._actionSet[a.toString()]=0}static noteActionRun(a){h._currentAction=a,h._actionRunCounter++,h.setAction(a),void 0==h._actionFirstRun[a.toString()]&&(h._actionFirstRun[a.toString()]=h._actionRunCounter),h._actionLastRun[a.toString()]=h._actionRunCounter}static checkRelations(a){var b=null,c=NaN;if(h.isSetAction(a))return console.log(a+" relation unfulfilled: action is set"),!1;for(b in h._actionMust[a.toString()])if(!h.isSetAction(h._actionMust[a.toString()][b]))return console.log(a+" relation unfulfilled: must "+h._actionMust[a.toString()][b]),!1;for(b in h._actionMustNot[a.toString()])if(h.isSetAction(h._actionMustNot[a.toString()][b]))return console.log(a+" relation unfulfilled: mustnot "+h._actionMustNot[a.toString()][b]),!1;if(void 0!=h._actionNumActions[a.toString()]&&h._actionRunCounter<h._actionNumActions[a.toString()])return console.log(a+" relation unfulfilled: numactions > "+h._actionNumActions[a.toString()]+" (but is "+h._actionRunCounter+")"),!1;for(b in h._actionNumActionsFrom[a.toString()])if(c=h._actionRunCounter-h._actionFirstRun[h._actionNumActionsFrom[a.toString()][b].since],c<h._actionNumActionsFrom[a.toString()][b].num)return console.log(a+" relation unfulfilled: numactionsfrom "+h._actionNumActionsFrom[a.toString()][b].since+" > "+h._actionNumActionsFrom[a.toString()][b].num+" (but is "+c+")"),!1;return console.log(a+" all relations fulfilled"),!0}static addMustNotRelation(a,b){void 0==h._actionMustNot[a.toString()]&&(h._actionMustNot[a.toString()]=new Array),h._actionMustNot[a.toString()].push(b)}static addMustRelation(a,b){void 0==h._actionMust[a.toString()]&&(h._actionMust[a.toString()]=new Array),h._actionMust[a.toString()].push(b)}static addNumActionsFromRelation(a,b,c){void 0==h._actionNumActionsFrom[a.toString()]&&(h._actionNumActionsFrom[a.toString()]=new Array),h._actionNumActionsFrom[a.toString()].push({num:c,since:b})}static addNumActionsRelation(a,b){h._actionNumActions[a.toString()]=b}static getCurrentAction(){return h._currentAction}static addRepeat(a,b){void 0==h._actionRepeat[a.toString()]&&(h._actionRepeat[a.toString()]=1),h._actionRepeat[a.toString()]=h._actionRepeat[a.toString()]+b}static setRepeat(a,b){h._actionRepeat[a.toString()]=b}static delRepeat(a,b){void 0==h._actionRepeat[a.toString()]&&(h._actionRepeat[a.toString()]=1),h._actionRepeat[a.toString()]=h._actionRepeat[a.toString()]-b}static isSetAction(a){return void 0==h._actionRepeat[a.toString()]&&(h._actionRepeat[a.toString()]=1),void 0==h._actionSet[a.toString()]&&(h._actionSet[a.toString()]=0),h._actionSet[a.toString()]>=h._actionRepeat[a.toString()]}}h._actionSet=new Array,h._actionRunCounter=0,h._actionFirstRun=new Array,h._actionLastRun=new Array,h._actionRepeat=new Array,h._actionNumActions=new Array,h._actionMustNot=new Array,h._actionMust=new Array,h._actionNumActionsFrom=new Array;class i extends a{initialize(a,b){this.bounds=b}setBounds(a){this.bounds=a,this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height}setViewer(a){this.viewer=a}}class j extends i{render(a){}}class k extends j{}class l extends j{initialize(a,b){for(var c=0;a["action"+c]instanceof e;c++)h.setAction(a["action"+c])}}class m extends j{initialize(a,b){for(var c=0;a["action"+c]instanceof e;c++)h.unsetAction(a["action"+c])}}class n extends j{initialize(a,b){this.viewer.runAction(a.target)}}class o extends j{initialize(a,b){for(var c=0;a["action"+c]instanceof e;c++)h.addMustRelation(a.self,a["action"+c])}}class p extends j{initialize(a,b){for(var c=0;a["action"+c]instanceof e;c++)h.addMustNotRelation(a.self,a["action"+c])}}class q extends j{initialize(a,b){h.addNumActionsRelation(a.self,a.count)}}class r extends j{initialize(a,b){h.addNumActionsFromRelation(a.self,a.since,a.count)}}class s extends j{initialize(a,b){this._result=Math.floor(Math.random()*(a.max-a.min))+a.min,console.log("Random number between "+a.min+" and "+a.max+": "+this._result)}getResult(){return this._result}}class t extends j{initialize(a,b){void 0!=a.max?this._total=Math.floor(Math.random()*(a.max-a.count))+a.count:this._total=a.count,this._targetAction=a.target}getAction(){var a=h.getCurrentAction(),b=a.toString();return void 0==t._repeats[b]&&(t._repeats[b]=0),t._repeats[b]<this._total?(t._repeats[b]=t._repeats[b]+1,console.log("Repeating action ("+t._repeats[b]+"/"+this._total+")..."),a):(t._repeats[b]=0,this.viewer.resolveAction(this._targetAction.toString()))}}t._repeats=new Array;class u extends j{initialize(a,b){var c=null;this._validActions=new Array;for(var d=void 0!=a.prefix?a.prefix:"",f=a.from;f<=a.to;f++)c=new e(d+f.toString()),this.viewer.isValidAction(c.toString())&&h.checkRelations(c)&&this._validActions.push(c)}getAction(){if(null==this._validActions||0==this._validActions.length)return console.error("Range failed: All actions set!"),null;var a=Math.floor(Math.random()*this._validActions.length);return this._validActions[a]}}class v extends j{initialize(a,b){h.addRepeat(a.target,a.count)}}class w extends j{initialize(a,b){h.delRepeat(a.target,a.count)}}class x extends j{initialize(a,b){h.setRepeat(a.target,a.count)}}class y extends i{constructor(){super(...arguments),this.CLOCKTEMPLATE=`<div>
  <style>
    .wrapper {
      background:#E89E9E;
      width:$SIZE$px;
      height:$SIZE$px;
      position:relative;
      margin:4px auto;    
      border:1px solid #B85959;
      border-radius:50%;
    }  
    
    .pie {
      width:50%;
      height:100%;
      position:absolute;
      background-color:#B85959;
      transform-origin: 100% 50%;
      border:0px solid rgba(0,0,0,0.4);
    }
    
    .spinner {
      border-radius:100% 0 0 100% / 50% 0 0 50%;
      z-index:200;
      border-right:none;            
      animation: rota $SECONDS$s linear 1;
      animation-fill-mode:forwards;
    }
    
    .filler {
      border-radius:0 100% 100% 0 / 0 50% 50% 0;
      z-index:100;
      border-left:none;
      animation:mask $SECONDS$s steps(1,end) 1 reverse;
      animation-fill-mode:forwards;
      left:50%;
      opacity:0;
    }
    
    .mask {
      width:50%;
      height:100%;
      position:absolute;
      z-index:300;      
      opacity:1;
      background:inherit;
      border-radius:100% 0 0 100% / 50% 0 0 50%;
      animation:mask $SECONDS$s steps(1,end) 1;
      animation-fill-mode:forwards;
    }
    
    @keyframes rota {
      0% { transform:rotate(0deg); }
      100% { transform:rotate(360deg);}
    }
    
    @keyframes mask {
      0%        { opacity: 1; }
      50%, 100% { opacity: 0; }
    }
    
    .pietext {
      position:relative;      
      z-index:500;
      height:100%;
    }
    
    .pietext p {      
      position:absolute;
      top:60%;
      transform:translate(-50%,-50%);
      margin:0;
      left:50%;
      color:white;
      font-weight:bold;
    }
  </style>
  <div class="wrapper">
    <div class="pie spinner"></div>
    <div class="pie filler"></div>
    <div class="mask"></div>    
    <div class="pietext"><p></p></div>
  </div>
</div>`,this.UNKNOWNTEMPLATE=`<div>
  <style>
    .wrapper {
      background:#E89E9E;
      width:$SIZE$px;
      height:$SIZE$px;
      position:relative;
      margin:4px auto;    
      border:1px solid #B85959;
      border-radius:50%;
    }  
    
    .pie {
      width:50%;
      height:100%;
      position:absolute;
      background-color:#B85959;
      transform-origin: 100% 50%;
    }
    
    .spinner {
      border-radius:100% 0 0 100% / 50% 0 0 50%;
      z-index:200;
      border-right:none;           
      transform:rotate(35deg);     
    }
    
    .filler {
      border-radius:0 100% 100% 0 / 0 50% 50% 0;
      z-index:100;
      border-left:none;
      left:50%;
      opacity:0;
    }
    
    .mask {
      width:50%;
      height:100%;
      position:absolute;
      z-index:300;      
      opacity:1;
      background:inherit;
      border-radius:100% 0 0 100% / 50% 0 0 50%;
    }
        
    .pietext {
      position:relative;      
      z-index:500;
      height:100%;
    }
    
    .pietext p {      
      position:absolute;
      top:50%;
      transform:translate(-50%,-50%);
      margin:0;
      left:50%;
      color:white;
      font-weight:bold;
      font-size:90px;
      font-family:serif;
    }
    
    .fgpie {
      background-color:white;
      z-index:450;
      position:absolute;
      width:100%;
      height:100%;
      border-radius:50%;
      opacity:0;
      animation:mask 500ms ease infinite ; 
      animation-direction: alternate;
    }
    
    @keyframes mask {
      0%        { opacity: 0.5; }
      50%, 100% { opacity: 0; }
    }
  </style>
  <div class="wrapper">
    <div class="pie spinner"></div>
    <div class="pie filler"></div>
    <div class="mask"></div>    
    <div class="fgpie"></div>  
    <div class="pietext"><p>?</p></div>
  </div>
</div>`}initialize(a,b){if(super.initialize(a,b),a.time instanceof c){var d=a.time.loadCmdClip(this.viewer);a.time=d.getResult()}f.get("DEBUG",!1)&&(a.style="normal",a.time=2);var e=(new Date).getTime(),g=1e3*a.time,h=e+g;if("secret"==a.style){var i=Math.min(b.width,b.height,100),j=$(this.UNKNOWNTEMPLATE.split("$SIZE$").join(i.toString()));this.node.append(j)}else if("hidden"==a.style)console.log("Hidden delay: "+a.time+" seconds");else{var i=Math.min(b.width,b.height,100),j=$(this.CLOCKTEMPLATE.split("$SECONDS$").join(a.time).split("$SIZE$").join(i.toString()));this._remainingTime=j.find(".pietext>p"),this.node.append(j)}this._timer=window.setInterval(()=>{var b=NaN,c=NaN;if(this._destroyed)return void window.clearInterval(this._timer);var d=h-(new Date).getTime(),e=Math.min(Math.ceil(400*(1-d/g)),400);"secret"!=a.style&&"hidden"!=a.style&&(b=Math.ceil(d/1e3),b>60?(c=Math.floor(b/60),b%=60,b<10?this._remainingTime.text(c+":0"+b):this._remainingTime.text(c+":"+b)):this._remainingTime.text(b.toString())),400==e&&(window.clearInterval(this._timer),this.viewer.runAction(a.target))},100),this.setBounds(b)}destroy(){this._destroyed=!0,super.destroy()}}class z extends i{initialize(a,b){super.initialize(a,b),this._textField=$('<p style="text-align:center;margin:0 5px;"></p>');var c=$(a.text);c.find("font").attr("size",(a,b)=>{return Number(b)/5}),c.find("font").attr("face","");var d=/(https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*))/gi;c.each(function(){$(this).html($(this).html().replace(d,'<a href="$1" target="_blank">$1</a>'))}),this._textField.html($("<div>").append(c).html()),this._textField.css("padding","20 10"),this.node.css("overflow-y","auto"),this.node.append(this._textField),this.setBounds(b)}}class A extends i{initialize(a,b){super.initialize(a,b),void 0==a.id&&(a.id="");var c=g.showImage(a.id,a=>this.createImage(a));null!=c&&this.createImage(c)}createImage(a){this._img=$("<img />"),this._img.load(()=>this.setBounds(this.bounds)),this._img.attr("src",a),this._img.css("position","absolute"),this.node.append(this._img)}setBounds(a){super.setBounds(a),null!=this._img&&(this._img.width()/this._img.height()>a.width/a.height?(this._img.width(a.width),this._img.css("left",a.x),this._img.css("top",a.y+(a.height-this._img.height())/2)):(this._img.height(a.height),this._img.css("top",a.y),this._img.css("left",a.x+(a.width-this._img.width())/2)))}}class B extends j{initialize(a,b){void 0==a.id&&(a.id=""),void 0==a.loops&&(a.loops=1);var c=g.getSound(a.id,a=>this.createElement(a));null!=c&&this.createElement(c)}createElement(a){this._sound=new Audio(a),this._sound.play(),this.node.append(this._sound)}destroy(){this._sound&&!this._sound.paused&&this._sound.pause()}}class C extends i{constructor(){super(...arguments),this._elements=new Array}initialize(a,b){super.initialize(a,b);for(var d=0;a["e"+d]instanceof c;d++)this._elements[d]=a["e"+d].loadCmdClip(this.viewer,b),this.addChild(this._elements[d]);this.setBounds(b)}destroy(){for(var a in this._elements)this._elements[a].destroy();super.destroy()}setBounds(a){super.setBounds(a);var b=a;b.x=0,b.y=0;for(var c in this._elements)this._elements[c].setBounds(b)}}class D extends a{constructor(a){super(),this.node=$("<button>"+a+"</button>"),this.node.css("position","absolute")}addClickHandler(a){this.node.click(b=>a(this))}}class E extends i{initialize(a,b){super.initialize(a,b),this._button=new D("Continue"),this._button.addClickHandler(b=>{this.viewer.runAction(a.target)}),this.addChild(this._button),this.setBounds(this.bounds)}setBounds(a){var b=a.width-20,c=25;super.setBounds(a),this._button.y=10,this._button.width=b,this._button.height=c,this._button.x=a.width/2-this._button.width/2}}class F extends i{initialize(a,b){super.initialize(a,b),this._yesButton=new D("YES"),this._yesButton.addClickHandler(b=>{this.viewer.runAction(a.yes.toString())}),this.addChild(this._yesButton),this._noButton=new D("NO"),this._noButton.addClickHandler(b=>{this.viewer.runAction(a.no.toString())}),this.addChild(this._noButton),this.setBounds(this.bounds)}setBounds(a){var b=a.width-20,c=25;super.setBounds(a),this._yesButton.y=10,this._yesButton.width=b,this._yesButton.height=c,this._yesButton.x=a.width/2-this._yesButton.width/2,this._noButton.y=45,this._noButton.width=b,this._noButton.height=c,this._noButton.x=a.width/2-this._noButton.width/2}}class G extends i{constructor(){super(...arguments),this._elements=new Array}initialize(a,b){super.initialize(a,b);for(var d=0;a["e"+d]instanceof c;d++)this._elements[d]=a["e"+d].loadCmdClip(this.viewer,this.calculateElementBounds(b,d)),this.addChild(this._elements[d]);this.setBounds(b)}setBounds(a){super.setBounds(a);for(var b in this._elements)this._elements[b].setBounds(this.calculateElementBounds(a,Number(b)))}destroy(){for(var a in this._elements)this._elements[a].destroy()}calculateElementBounds(a,b){var c=a.width/this._elements.length;return{x:c*b,y:0,width:c,height:a.height}}}class H extends G{calculateElementBounds(a,b){var c=a.height/this._elements.length;return{x:0,y:c*b,width:a.width,height:c}}}class I extends i{constructor(){super(...arguments),this._buttonCaps=new Array,this._buttons=new Array}initialize(a,b){super.initialize(a,b);for(var c=null,d=0;null!=a["target"+d];d++)c=a["cap"+d]?a["cap"+d]:d.toString(),this.addButton(d,a["target"+d],c);this.setBounds(b)}addButton(a,b,c){this._buttons[a]=new D(c),this._buttons[a].addClickHandler(a=>{this.viewer.runAction(b.toString())}),this.addChild(this._buttons[a])}calculateButtonBounds(a,b){var c=a.width-20,d=25;return{x:a.width/2-c/2,y:35*b,width:c,height:d}}setBounds(a){super.setBounds(a);for(var b in this._buttons){var c=this.calculateButtonBounds(a,Number(b));this._buttons[b].x=c.x,this._buttons[b].y=c.y,this._buttons[b].width=c.width,this._buttons[b].height=c.height}}}class J extends i{constructor(){super(),this.node.css("border-left","2px solid #B85959"),this.node.css("background-color","#F3E2E2")}}class K extends i{initialize(a,b){if(super.initialize(a,b),(a.instruc instanceof c||a.action instanceof c)&&(this._splitView=new J,this.addChild(this._splitView),this.positionSidebar(b)),a.text instanceof c)this._textClip=a.text.loadCmdClip(this.viewer,"text",this.calculateTextBounds(b)),this.addChild(this._textClip);else if("String"==a.text.constructor.name){var d=new c("text(text:'"+a.text.split("'").join("\\'")+"')");this._textClip=d.loadCmdClip(this.viewer,this.calculateTextBounds(b)),this.addChild(this._textClip)}if(a.media instanceof c&&(this._mediaClip=a.media.loadCmdClip(this.viewer,this.calculateMediaBounds(b)),this.addChild(this._mediaClip)),a.instruc instanceof c&&(this._instrucClip=a.instruc.loadCmdClip(this.viewer,this.calculateInstrucBounds(b)),this.addChild(this._instrucClip)),a.action instanceof c&&(this._actionClip=a.action.loadCmdClip(this.viewer,this.calculateActionBounds(b)),this.addChild(this._actionClip)),a.hidden instanceof c&&(this._hiddenClip=a.hidden.loadCmdClip(this.viewer,{})),this.setBounds(b),null==this._splitView&&null==this._actionClip&&null==this._hiddenClip){this._splitView=new J,this.addChild(this._splitView),this.positionSidebar(b);var e=new c("buttons(target0:'exittease',cap0:'Exit Tease')");this._actionClip=e.loadCmdClip(this.viewer,this.calculateActionBounds(b)),this.addChild(this._actionClip)}}setBounds(a){null!=this._splitView&&this.positionSidebar(a),null!=this._textClip&&this._textClip.setBounds(this.calculateTextBounds(a)),null!=this._mediaClip&&this._mediaClip.setBounds(this.calculateMediaBounds(a)),null!=this._instrucClip&&this._instrucClip.setBounds(this.calculateInstrucBounds(a)),null!=this._actionClip&&this._actionClip.setBounds(this.calculateActionBounds(a)),super.setBounds(a)}destroy(){null!=this._hiddenClip&&(this._hiddenClip.destroy(),this._hiddenClip=null),super.destroy()}calculateTextBounds(a){var b=null!=this._splitView?Number(a.width-150):Number(a.width);return{x:a.x,y:a.y+.7*a.height,width:b,height:.3*a.height}}calculateInstrucBounds(a){return{x:a.x+a.width-150,y:a.y,width:150,height:.5*a.height}}calculateMediaBounds(a){var b=null!=this._splitView?Number(a.width-150):Number(a.width);return{x:a.x,y:a.y,width:b,height:.7*a.height}}calculateActionBounds(a){return{x:a.x+a.width-150,y:a.y+.5*a.height,width:150,height:.5*a.height}}positionSidebar(a){this._splitView.x=a.x+a.width-150,this._splitView.y=a.y,this._splitView.width=150,this._splitView.height=a.height}}class L{static explode(a,b){var c=NaN,d=null,e=new Array;if(null==a)return[];if(null==b)return[];for(var f=0;f<b.length&&(c=b.indexOf(a,f),c!=-1);)d=b.slice(f,c),e.push(d),f=c+1;return e.length<1?e.push(b):e.push(b.slice(f,b.length)),e}static explodeWithParenthesis(a,b){var c=null;if(null==b)return[];for(var d=new Array,e="",f="",g=0,h=0,i=0,j=0;j<b.length;j++){switch(e=b.charAt(j),g){case 0:"'"==e?g=1:'"'==e?g=2:"("==e?h++:")"==e?h--:e==a&&0==h&&(c=b.slice(i,j),d.push(c),i=j+1);break;case 1:"'"==e&&"\\"!=f&&(g=0);break;case 2:'"'==e&&"\\"!=f&&(g=0)}f=e}return d.length<1?d.push(b):d.push(b.slice(i,b.length)),d}static parseParameter(a){return"'"==a.substr(0,1)||'"'==a.substr(0,1)?L.parseString(a):"#"==a.substr(-1)?new e(a.substr(0,a.length-1)):"hrs"==a.substr(-3)||"min"==a.substr(-3)||"sec"==a.substr(-3)?L.parseTime(a):isNaN(parseInt(a))?a.indexOf("(")&&")"==a.substr(-1)?new c(a):a:parseInt(a)}static parseParamList(a){var b=null,c=null,d=NaN,e=null,f=null,g=L.explodeWithParenthesis(",",a),h=new Array;for(b in g)c=g[b],d=c.indexOf(":"),e=c.substr(0,d),f=c.substr(d+1),h[e]=L.parseParameter(f);return h}static parseString(a){return a=a.substr(1,a.length-2),a=a.split("\\'").join("'")}static parseTime(a){var b=a.substr(-3),c=parseInt(a.substr(0,a.length-3));return"hrs"==b?3600*c:"min"==b?60*c:c}}class M{constructor(a){this._target=a,this.render(),this._target.hide()}show(){this._target.show(1)}render(){var a=$("<div></div>");a.append("<p>Please rate this tease.</p>");for(var b=this,c=1;c<=5;c++){var d=$(`<img src="images/ustar.png" data-id="${c}" title="${c} Star${c>1?"s":""}" />`);d.mouseenter(function(c){b.highlight(a,Number($(c.target).attr("data-id")),!0)}),d.mouseout(function(c){b.highlight(a,Number($(c.target).attr("data-id")),!1)}),d.click(function(a){b.submit(Number($(a.target).attr("data-id")))}),a.append(d)}a.append('<p><a href="/">Go Back.</a></p>'),this._target.append(a)}highlight(a,b,c){for(var d=a.find("img"),e=0;e<b;e++)$(d[e]).attr("src",c?"images/star.png":"images/ustar.png")}submit(a){$.ajax({url:`vote?id=${f.get("teaseId")}&vote=${a}`,type:"GET",success:function(a){location.href="/"}})}}$().ready(()=>runTease(Number(getQueryVariable("id"))));