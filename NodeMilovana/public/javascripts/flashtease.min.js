function getQueryVariable(a){for(var b=window.location.search.substring(1),c=b.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if(decodeURIComponent(e[0])==a)return decodeURIComponent(e[1])}console.log("Query variable %s not found",a)}function launchIntoFullscreen(a){a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()}function runTease(a,b){return __awaiter(this,void 0,void 0,function(){var c,d;return __generator(this,function(e){switch(e.label){case 0:return Settings.set("teaseId",a),$("#exit").click(function(){rating.show()}),rating=new Rating($("#rating")),c=new FlashTease(a,$("#tease")),[4,c.parse()];case 1:return e.sent(),$("#loading").hide(),1==b?(d=c.loadState(!1),d==StateLoadResult.VersionMismatch&&(console.log("Version mismatch with saved data"),confirm("The tease was updated since your last visit.\nContinuing may result in strange behavior. Do you really want to load your saved state?")&&(d=c.loadState(!0))),d!=StateLoadResult.Ok&&(console.log("Failed to load state."),c.start())):c.start(),[2]}})})}var rating,StateLoadResult,__extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),__awaiter=this&&this.__awaiter||function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})},__generator=this&&this.__generator||function(a,b){function c(a){return function(b){return d([a,b])}}function d(c){if(e)throw new TypeError("Generator is already executing.");for(;i;)try{if(e=1,f&&(g=f[2&c[0]?"return":c[0]?"throw":"next"])&&!(g=g.call(f,c[1])).done)return g;switch(f=0,g&&(c=[0,g.value]),c[0]){case 0:case 1:g=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,f=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(g=i.trys,!(g=g.length>0&&g[g.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!g||c[1]>g[0]&&c[1]<g[3])){i.label=c[1];break}if(6===c[0]&&i.label<g[1]){i.label=g[1],g=c;break}if(g&&i.label<g[2]){i.label=g[2],i.ops.push(c);break}g[2]&&i.ops.pop(),i.trys.pop();continue}c=b.call(a,i)}catch(a){c=[6,a],f=0}finally{e=g=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}var e,f,g,h,i={label:0,sent:function(){if(1&g[0])throw g[1];return g[1]},trys:[],ops:[]};return h={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h},Control=function(){function a(){this.children=Array(),this._x=0,this._y=0,this._width=0,this._height=0,this.node=$("<div></div>"),this.node.attr("flashclass",this.constructor.name)}return Object.defineProperty(a.prototype,"x",{get:function(){return this._x},set:function(a){this._x=a,this.updateNode()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"y",{get:function(){return this._y},set:function(a){this._y=a,this.updateNode()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a,this.updateNode()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a,this.updateNode()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"parent",{get:function(){return this._parent},set:function(a){this._parent=a},enumerable:!0,configurable:!0}),a.prototype.updateNode=function(){this.node.css("box-sizing","content-box"),this.node.width(this.width),this.node.height(this.height),this.node.css("left",this.x),this.node.css("top",this.y),this.node.css("position","absolute"),this.node.css("box-sizing","")},a.prototype.render=function(a){for(var b in this.children)this.children[b].render(this.node);a.append(this.node)},a.prototype.addChild=function(a){this.children.push(a),a.parent=this},a.prototype.removeChild=function(a){a.parent=null,a.destroy(),delete this.children[this.children.indexOf(a)]},a.prototype.destroy=function(){for(var a in this.children)this.children[a].destroy();this.node.remove()},a}();!function(a){a[a.Ok=0]="Ok",a[a.NoData=1]="NoData",a[a.VersionMismatch=2]="VersionMismatch"}(StateLoadResult||(StateLoadResult={}));var FlashTease=function(a){function b(b,c){var d=a.call(this)||this;return $(window).resize(function(a){d.width=c.width(),d.height=c.height(),d._currentClip.setBounds(d.bounds)}),d._id=b,d._renderTarget=c,d._actionRegistry=new Array,d.width=c.width(),d.height=c.height(),d}return __extends(b,a),b.prototype.saveState=function(){window.localStorage.setItem("tease-"+this._id,Pcm2Compat.serialize(this._scriptHash))},b.prototype.loadState=function(a){var b=window.localStorage.getItem("tease-"+this._id);if(!b||""==b)return StateLoadResult.NoData;var c=Pcm2Compat.deserialize(this._scriptHash,b,a);return c==StateLoadResult.Ok&&this.runAction(Pcm2Compat.getCurrentAction().toString(),!1),c},b.prototype.load=function(){var a=this;return new Promise(function(b,c){return jQuery.get("script?id="+a._id,function(c,d,e){console.log("downloaded script successfully"),a._scriptHash=SparkMD5.hash(c),a._script=c,b()})})},b.prototype.loadMeta=function(){var a=this;return new Promise(function(b,c){return jQuery.get("meta?id="+a._id,function(a){console.log("downloaded metadata successfully"),MediaLoader.interpretMetainfo(a),MediaLoader.cacheAction(new ActionString("start")),b()})})},b.prototype.parse=function(){return __awaiter(this,void 0,void 0,function(){var a,b,c,d,e,f;return __generator(this,function(g){switch(g.label){case 0:return this._script?[3,3]:[4,this.load()];case 1:return g.sent(),[4,this.loadMeta()];case 2:g.sent(),g.label=3;case 3:a=Parser.explode("\n",this._script);for(b in a)c=a[b],0!=c.length&&(d=c.indexOf("#"),d==-1||d>c.indexOf("(")?this.runCommandAsAction(new CommandString(c)):(e=c.substr(0,d),f=c.substr(d+1),this.addAction(e,f)));return[2]}})})},b.prototype.start=function(){this.runAction("start")},b.prototype.runAction=function(a,b){void 0===b&&(b=!0);var c=null,d=null,e=null,f=NaN;if(a instanceof ActionString&&(a=a.toString()),a instanceof CommandString&&(a=a.toString()),d=this.resolveAction(a),console.log("Running action "+d+"..."),"exittease"==d.toString())return window.localStorage.removeItem("tease-"+this._id),void rating.show();if(void 0!=this._actionRegistry[d.toString()]){if(c=this._actionRegistry[d.toString()],b&&Pcm2Compat.noteActionRun(d),MediaLoader.cacheAction(d),"{"==c.substr(0,1)){for(e=Parser.explodeWithParenthesis(";",c.substr(1)),c="mult(",f=0;e.length;)c=c+"e"+f+":"+e.shift(),f++,e.length&&(c+=",");c+=")"}var g=Parser.parseParameter(c);return g instanceof CommandString||console.error(this,"Action "+d+" does not contain a valid command."),void this.runCommandAsAction(g)}console.error(this,"Action not found: "+d)},b.prototype.isValidAction=function(a){return void 0!=this._actionRegistry[a]},b.prototype.runCommandAsAction=function(a){this.clearCurrentClip(),this._currentClip=a.getCmdObject(),this._currentClip.setViewer(this);var b=a.getInputVars();this.addChild(this._currentClip),this._currentClip.initialize(b,this.bounds),this.render(this._renderTarget),this.saveState()},b.prototype.clearCurrentClip=function(){null!=this._currentClip&&(this._currentClip.destroy(),this._currentClip.parent==this&&this.removeChild(this._currentClip))},b.prototype.resolveAction=function(a){var b=null,c=null;return")"==a.substr(-1)?(c=new CommandString(a).loadCmdClip(this),b=c.getAction()):b=new ActionString(a),b},b.prototype.addAction=function(a,b){this._actionRegistry[a]=b},Object.defineProperty(b.prototype,"bounds",{get:function(){return{x:this.x,y:this.y,width:this.width,height:this.height}},enumerable:!0,configurable:!0}),b}(Control),CommandString=function(){function a(a){this._action=a}return a.prototype.getCmdObject=function(){var a=this._action.indexOf("("),b=this._action.substr(0,a);return Library.getCommandClass(b)},a.prototype.loadCmdClip=function(a,b){void 0===b&&(b=null);var c=this.getCmdObject(),d=this.getInputVars();return c.setViewer(a),null==b&&(b={x:0,y:0,width:0,height:0}),c.initialize(d,b),c},a.prototype.getInputVars=function(){var a=this._action.indexOf("("),b=this._action.substr(a+1,this._action.length-a-2);return Parser.parseParamList(b)},a.prototype.toString=function(){return this._action},a}(),Library=function(){function a(){}return a.getCommandClass=function(a){switch(a){case"buttons":return new Buttons;case"page":return new Page;case"text":return new TextView;case"pic":return new Pic;case"mult":return new Mult;case"yn":return new Yn;case"set":return new SetCommand;case"unset":return new UnsetCommand;case"delay":return new Delay;case"go":return new Go;case"range":return new RangeCommand;case"dummy":return new Dummy;case"goto":return new Goto;case"horiz":return new Horiz;case"vert":return new Vert;case"must":return new Must;case"mustnot":return new MustNot;case"numactions":return new NumActions;case"numactionsfrom":return new NumActionsFrom;case"random":return new RandomCommand;case"repeat":return new Repeat;case"repeatadd":return new RepeatAdd;case"repeatdel":return new RepeatDel;case"repeatset":return new RepeatSet;case"sound":return new SoundCommand}return console.log("Invalid command: "+a),new Dummy},a}(),ActionString=function(){function a(a){var b=this;this.toString=function(){return b._string},this._string=a}return a}(),Settings=function(){function a(){}return a.get=function(b,c){return void 0===c&&(c=null),void 0==a._settings[b]?c:a._settings[b]},a.set=function(b,c){a._settings[b]=c},a}();Settings._settings=Array();var MediaImage=function(){function a(a){this.url=a}return a}(),Sound=function(){function a(a){this.url=a}return a}(),MediaLoader=function(){function a(){}return a.showImage=function(b,c){if(void 0===c&&(c=null),null!=a._loadedImages[b]){console.log("Image "+b+" from cache...");var d=a._loadedImages[b];return b.indexOf("*")>-1&&delete a._loadedImages[b],d}return console.log("Downloading image "+b+" ..."),b="medialocation?folder="+Settings.get("mediaFolder")+"&id="+b,$.get(b,function(d){a._loadedImages[b]=new MediaImage(d),c(d)}),null},a.getSound=function(b,c){if(void 0===c&&(c=null),null!=a._loadedSounds[b]){console.log("Sound "+b+" from cache...");var d=a._loadedSounds[b];return b.indexOf("*")>-1&&delete a._loadedSounds[b],d}console.log("Downloading sound "+b+" ..."),b="medialocation?folder="+Settings.get("mediaFolder")+"&id="+b,$.get(b,function(d){a._loadedSounds[b]=new Sound(d),c(d)})},a.emptyQueue=function(){a._queue=[]},a.queueMedia=function(b){a._queue.push(b)},a.runQueue=function(){a._queueRunning||(a._queueRunning=!0,a.loadNextQueueItem())},a.loadNextQueueItem=function(b){if(void 0===b&&(b=null),window.clearInterval(a._queueIdleTimer),0==a._queue.length)return void(a._queueIdleTimer=window.setInterval(a.loadNextQueueItem,1e3));var c=a._queue.shift();"pic:"==c.substr(0,4)?a.loadImage(c.substr(4)):"sound:"==c.substr(0,6)?a.loadSound(c.substr(6)):a.loadNextQueueItem()},a.loadSound=function(b){if(null!=a._loadedSounds[b])return void a.loadNextQueueItem();var c="medialocation?folder="+Settings.get("mediaFolder")+"&id="+b;console.log("Preloading "+c+"..."),$.get(c,function(c){var d=document.createElement("audio");d.autoplay=!1,d.preload="auto",d.addEventListener("loadeddata",function(d){a._loadedSounds[b]=new Sound(c),a._loadedSounds[b].audio=d.target,a.loadNextQueueItem()}),d.src=c})},a.loadImage=function(b){if(null!=a._loadedImages[b])return void a.loadNextQueueItem();var c="medialocation?folder="+Settings.get("mediaFolder")+"&id="+b;console.log("Preloading "+c+"..."),$.get(c,function(c){var d=document.createElement("img");d.addEventListener("load",function(d){var e=d.target;a._loadedImages[b]=new MediaImage(c),a._loadedImages[b].width=e.width,a._loadedImages[b].height=e.height,a.loadNextQueueItem()}),d.src=c})},a.cacheAction=function(b){a.emptyQueue(),a.queueActionMedia(b);for(var c in a._execTree[b.toString()])a.queueActionMedia(a._execTree[b.toString()][c]);a.runQueue()},a.queueActionMedia=function(b){for(var c in a._mediaList[b.toString()])a.queueMedia(a._mediaList[b.toString()][c])},a.interpretMetainfo=function(b){var c=null,d=NaN,e=null,f=null,g=null;console.log("MetaInfo loaded.");var h=b.split("\n"),i=h[0];h[1],h[2];Settings.set("mediaFolder",i+"/"+Settings.get("teaseId")),h=h.slice(3);var j=1;for(c in h)if("=============================="==h[c])j=2;else if(j>0){d=h[c].indexOf("#"),e=new ActionString(h[c].substr(0,d)),f=h[c].substr(d+1).split(",");for(g in f)1==j?a.addMediaInstance(e,f[g]):a.addExecRelation(e,new ActionString(f[g]))}},a.addExecRelation=function(b,c){null==a._execTree[b.toString()]&&(a._execTree[b.toString()]=new Array),a._execTree[b.toString()].push(c)},a.addMediaInstance=function(b,c){null==a._mediaList[b.toString()]&&(a._mediaList[b.toString()]=new Array),a._mediaList[b.toString()].push(c)},a}();MediaLoader._mediaList=new Array,MediaLoader._execTree=new Array,MediaLoader._queue=new Array,MediaLoader._queueRunning=!1,MediaLoader._loadedImages=new Array,MediaLoader._loadedSounds=new Array;var Pcm2Compat=function(){function a(){}return a.serialize=function(b){var c={version:1,hash:b,actionSet:a._actionSet,currentAction:a._currentAction.toString(),actionRunCounter:a._actionRunCounter,actionFirstRun:a._actionFirstRun,actionLastRun:a._actionLastRun,actionRepeat:a._actionRepeat,actionNumActions:a._actionNumActions,actionMustNot:a._actionMustNot,actionMust:a._actionMust,actionNumActionsFrom:a._actionNumActionsFrom};return JSON.stringify(c)},a.deserialize=function(b,c,d){var e=JSON.parse(c);return null==e?StateLoadResult.NoData:d||e.hash==b?(a._actionSet=e.actionSet,a._currentAction=new ActionString(e.currentAction),a._actionRunCounter=e.actionRunCounter,a._actionFirstRun=e.actionFirstRun,a._actionLastRun=e.actionLastRun,a._actionRepeat=e.actionRepeat,a._actionNumActions=e.actionNumActions,a._actionMustNot=e.actionMustNot,a._actionMust=e.actionMust,a._actionNumActionsFrom=e.actionNumActionsFrom,StateLoadResult.Ok):StateLoadResult.VersionMismatch},a.setAction=function(b){void 0==a._actionSet[b.toString()]&&(a._actionSet[b.toString()]=0),a._actionSet[b.toString()]=a._actionSet[b.toString()]+1},a.unsetAction=function(b){a._actionSet[b.toString()]=0},a.noteActionRun=function(b){a._currentAction=b,a._actionRunCounter++,a.setAction(b),void 0==a._actionFirstRun[b.toString()]&&(a._actionFirstRun[b.toString()]=a._actionRunCounter),a._actionLastRun[b.toString()]=a._actionRunCounter},a.checkRelations=function(b){var c=null,d=NaN;if(a.isSetAction(b))return console.log(b+" relation unfulfilled: action is set"),!1;for(c in a._actionMust[b.toString()])if(!a.isSetAction(a._actionMust[b.toString()][c]))return console.log(b+" relation unfulfilled: must "+a._actionMust[b.toString()][c]),!1;for(c in a._actionMustNot[b.toString()])if(a.isSetAction(a._actionMustNot[b.toString()][c]))return console.log(b+" relation unfulfilled: mustnot "+a._actionMustNot[b.toString()][c]),!1;if(void 0!=a._actionNumActions[b.toString()]&&a._actionRunCounter<a._actionNumActions[b.toString()])return console.log(b+" relation unfulfilled: numactions > "+a._actionNumActions[b.toString()]+" (but is "+a._actionRunCounter+")"),!1;for(c in a._actionNumActionsFrom[b.toString()])if((d=a._actionRunCounter-a._actionFirstRun[a._actionNumActionsFrom[b.toString()][c].since])<a._actionNumActionsFrom[b.toString()][c].num)return console.log(b+" relation unfulfilled: numactionsfrom "+a._actionNumActionsFrom[b.toString()][c].since+" > "+a._actionNumActionsFrom[b.toString()][c].num+" (but is "+d+")"),!1;return console.log(b+" all relations fulfilled"),!0},a.addMustNotRelation=function(b,c){void 0==a._actionMustNot[b.toString()]&&(a._actionMustNot[b.toString()]=new Array),a._actionMustNot[b.toString()].push(c)},a.addMustRelation=function(b,c){void 0==a._actionMust[b.toString()]&&(a._actionMust[b.toString()]=new Array),a._actionMust[b.toString()].push(c)},a.addNumActionsFromRelation=function(b,c,d){void 0==a._actionNumActionsFrom[b.toString()]&&(a._actionNumActionsFrom[b.toString()]=new Array),a._actionNumActionsFrom[b.toString()].push({num:d,since:c})},a.addNumActionsRelation=function(b,c){a._actionNumActions[b.toString()]=c},a.getCurrentAction=function(){return a._currentAction},a.addRepeat=function(b,c){void 0==a._actionRepeat[b.toString()]&&(a._actionRepeat[b.toString()]=1),a._actionRepeat[b.toString()]=a._actionRepeat[b.toString()]+c},a.setRepeat=function(b,c){a._actionRepeat[b.toString()]=c},a.delRepeat=function(b,c){void 0==a._actionRepeat[b.toString()]&&(a._actionRepeat[b.toString()]=1),a._actionRepeat[b.toString()]=a._actionRepeat[b.toString()]-c},a.isSetAction=function(b){return void 0==a._actionRepeat[b.toString()]&&(a._actionRepeat[b.toString()]=1),void 0==a._actionSet[b.toString()]&&(a._actionSet[b.toString()]=0),a._actionSet[b.toString()]>=a._actionRepeat[b.toString()]},a}();Pcm2Compat._actionSet=new Array,Pcm2Compat._actionRunCounter=0,Pcm2Compat._actionFirstRun=new Array,Pcm2Compat._actionLastRun=new Array,Pcm2Compat._actionRepeat=new Array,Pcm2Compat._actionNumActions=new Array,Pcm2Compat._actionMustNot=new Array,Pcm2Compat._actionMust=new Array,Pcm2Compat._actionNumActionsFrom=new Array;var Command=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.initialize=function(a,b){this.bounds=b},b.prototype.setBounds=function(a){this.bounds=a,this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height},b.prototype.setViewer=function(a){this.viewer=a},b}(Control),InvisibleCommand=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.render=function(a){},b}(Command),Dummy=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(InvisibleCommand),SetCommand=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.initialize=function(a,b){for(var c=0;a["action"+c]instanceof ActionString;c++)Pcm2Compat.setAction(a["action"+c])},b}(InvisibleCommand),UnsetCommand=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.initialize=function(a,b){for(var c=0;a["action"+c]instanceof ActionString;c++)Pcm2Compat.unsetAction(a["action"+c])},b}(InvisibleCommand),Goto=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.initialize=function(a,b){this.viewer.runAction(a.target)},b}(InvisibleCommand),Must=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.initialize=function(a,b){for(var c=0;a["action"+c]instanceof ActionString;c++)Pcm2Compat.addMustRelation(a.self,a["action"+c])},b}(InvisibleCommand),MustNot=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.initialize=function(a,b){for(var c=0;a["action"+c]instanceof ActionString;c++)Pcm2Compat.addMustNotRelation(a.self,a["action"+c])},b}(InvisibleCommand),NumActions=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.initialize=function(a,b){Pcm2Compat.addNumActionsRelation(a.self,a.count)},b}(InvisibleCommand),NumActionsFrom=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.initialize=function(a,b){Pcm2Compat.addNumActionsFromRelation(a.self,a.since,a.count)},b}(InvisibleCommand),RandomCommand=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.initialize=function(a,b){this._result=Math.floor(Math.random()*(a.max-a.min))+a.min,console.log("Random number between "+a.min+" and "+a.max+": "+this._result)},b.prototype.getResult=function(){return this._result},b}(InvisibleCommand),Repeat=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.initialize=function(a,b){void 0!=a.max?this._total=Math.floor(Math.random()*(a.max-a.count))+a.count:this._total=a.count,this._targetAction=a.target},b.prototype.getAction=function(){var a=Pcm2Compat.getCurrentAction(),c=a.toString();return void 0==b._repeats[c]&&(b._repeats[c]=0),b._repeats[c]<this._total?(b._repeats[c]=b._repeats[c]+1,console.log("Repeating action ("+b._repeats[c]+"/"+this._total+")..."),a):(b._repeats[c]=0,this.viewer.resolveAction(this._targetAction.toString()))},b}(InvisibleCommand);Repeat._repeats=new Array;var RangeCommand=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.initialize=function(a,b){var c=null;this._validActions=new Array;for(var d=void 0!=a.prefix?a.prefix:"",e=a.from;e<=a.to;e++)c=new ActionString(d+e.toString()),this.viewer.isValidAction(c.toString())&&Pcm2Compat.checkRelations(c)&&this._validActions.push(c)},b.prototype.getAction=function(){if(null==this._validActions||0==this._validActions.length)return console.error("Range failed: All actions set!"),null;var a=Math.floor(Math.random()*this._validActions.length);return this._validActions[a]},b}(InvisibleCommand),RepeatAdd=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.initialize=function(a,b){Pcm2Compat.addRepeat(a.target,a.count)},b}(InvisibleCommand),RepeatDel=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.initialize=function(a,b){Pcm2Compat.delRepeat(a.target,a.count)},b}(InvisibleCommand),RepeatSet=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.initialize=function(a,b){Pcm2Compat.setRepeat(a.target,a.count)},b}(InvisibleCommand),Delay=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.CLOCKTEMPLATE='<div>\n  <style>\n    .wrapper {\n      background:#E89E9E;\n      width:$SIZE$px;\n      height:$SIZE$px;\n      position:relative;\n      margin:4px auto;    \n      border:1px solid #B85959;\n      border-radius:50%;\n    }  \n    \n    .pie {\n      width:50%;\n      height:100%;\n      position:absolute;\n      background-color:#B85959;\n      transform-origin: 100% 50%;\n      border:0px solid rgba(0,0,0,0.4);\n    }\n    \n    .spinner {\n      border-radius:100% 0 0 100% / 50% 0 0 50%;\n      z-index:200;\n      border-right:none;            \n      animation: rota $SECONDS$s linear 1;\n      animation-fill-mode:forwards;\n    }\n    \n    .filler {\n      border-radius:0 100% 100% 0 / 0 50% 50% 0;\n      z-index:100;\n      border-left:none;\n      animation:mask $SECONDS$s steps(1,end) 1 reverse;\n      animation-fill-mode:forwards;\n      left:50%;\n      opacity:0;\n    }\n    \n    .mask {\n      width:50%;\n      height:100%;\n      position:absolute;\n      z-index:300;      \n      opacity:1;\n      background:inherit;\n      border-radius:100% 0 0 100% / 50% 0 0 50%;\n      animation:mask $SECONDS$s steps(1,end) 1;\n      animation-fill-mode:forwards;\n    }\n    \n    @keyframes rota {\n      0% { transform:rotate(0deg); }\n      100% { transform:rotate(360deg);}\n    }\n    \n    @keyframes mask {\n      0%        { opacity: 1; }\n      50%, 100% { opacity: 0; }\n    }\n    \n    .pietext {\n      position:relative;      \n      z-index:500;\n      height:100%;\n    }\n    \n    .pietext p {      \n      position:absolute;\n      top:60%;\n      transform:translate(-50%,-50%);\n      margin:0;\n      left:50%;\n      color:white;\n      font-weight:bold;\n    }\n  </style>\n  <div class="wrapper">\n    <div class="pie spinner"></div>\n    <div class="pie filler"></div>\n    <div class="mask"></div>    \n    <div class="pietext"><p></p></div>\n  </div>\n</div>',b.UNKNOWNTEMPLATE='<div>\n  <style>\n    .wrapper {\n      background:#E89E9E;\n      width:$SIZE$px;\n      height:$SIZE$px;\n      position:relative;\n      margin:4px auto;    \n      border:1px solid #B85959;\n      border-radius:50%;\n    }  \n    \n    .pie {\n      width:50%;\n      height:100%;\n      position:absolute;\n      background-color:#B85959;\n      transform-origin: 100% 50%;\n    }\n    \n    .spinner {\n      border-radius:100% 0 0 100% / 50% 0 0 50%;\n      z-index:200;\n      border-right:none;           \n      transform:rotate(35deg);     \n    }\n    \n    .filler {\n      border-radius:0 100% 100% 0 / 0 50% 50% 0;\n      z-index:100;\n      border-left:none;\n      left:50%;\n      opacity:0;\n    }\n    \n    .mask {\n      width:50%;\n      height:100%;\n      position:absolute;\n      z-index:300;      \n      opacity:1;\n      background:inherit;\n      border-radius:100% 0 0 100% / 50% 0 0 50%;\n    }\n        \n    .pietext {\n      position:relative;      \n      z-index:500;\n      height:100%;\n    }\n    \n    .pietext p {      \n      position:absolute;\n      top:50%;\n      transform:translate(-50%,-50%);\n      margin:0;\n      left:50%;\n      color:white;\n      font-weight:bold;\n      font-size:90px;\n      font-family:serif;\n    }\n    \n    .fgpie {\n      background-color:white;\n      z-index:450;\n      position:absolute;\n      width:100%;\n      height:100%;\n      border-radius:50%;\n      opacity:0;\n      animation:mask 500ms ease infinite ; \n      animation-direction: alternate;\n    }\n    \n    @keyframes mask {\n      0%        { opacity: 0.5; }\n      50%, 100% { opacity: 0; }\n    }\n  </style>\n  <div class="wrapper">\n    <div class="pie spinner"></div>\n    <div class="pie filler"></div>\n    <div class="mask"></div>    \n    <div class="fgpie"></div>  \n    <div class="pietext"><p>?</p></div>\n  </div>\n</div>',b}return __extends(b,a),b.prototype.initialize=function(b,c){var d=this;if(a.prototype.initialize.call(this,b,c),b.time instanceof CommandString){var e=b.time.loadCmdClip(this.viewer);b.time=e.getResult()}Settings.get("DEBUG",!1)&&(b.style="normal",b.time=2);var f=(new Date).getTime(),g=1e3*b.time,h=f+g;if("secret"==b.style){var i=Math.min(c.width,c.height,100),j=$(this.UNKNOWNTEMPLATE.split("$SIZE$").join(i.toString()));this.node.append(j)}else if("hidden"==b.style)console.log("Hidden delay: "+b.time+" seconds");else{var i=Math.min(c.width,c.height,100),j=$(this.CLOCKTEMPLATE.split("$SECONDS$").join(b.time).split("$SIZE$").join(i.toString()));this._remainingTime=j.find(".pietext>p"),this.node.append(j)}this._timer=window.setInterval(function(){var a=NaN,c=NaN;if(d._destroyed)return void window.clearInterval(d._timer);var e=h-(new Date).getTime(),f=Math.min(Math.ceil(400*(1-e/g)),400);"secret"!=b.style&&"hidden"!=b.style&&(a=Math.ceil(e/1e3),a>60?(c=Math.floor(a/60),a%=60,a<10?d._remainingTime.text(c+":0"+a):d._remainingTime.text(c+":"+a)):d._remainingTime.text(a.toString())),400==f&&(window.clearInterval(d._timer),d.viewer.runAction(b.target))},100),this.setBounds(c)},b.prototype.destroy=function(){this._destroyed=!0,a.prototype.destroy.call(this)},b}(Command),TextView=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.initialize=function(b,c){a.prototype.initialize.call(this,b,c),this._textField=$("<p></p>");var d=$(b.text);d.find("font").attr("size",function(a,b){return Number(b)/5}),d.find("font").attr("face","");d.each(function(){$(this).html($(this).html().replace(/(https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*))/gi,'<a href="$1" target="_blank">$1</a>'))}),this._textField.html($("<div>").append(d).html()),this.node.append(this._textField),this.setBounds(c)},b}(Command),Pic=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.initialize=function(b,c){var d=this;a.prototype.initialize.call(this,b,c),void 0==b.id&&(b.id="");var e=MediaLoader.showImage(b.id,function(a){return d.createImage(a,0,0)});null!=e&&this.createImage(e.url,e.width,e.height)},b.prototype.createImage=function(a,b,c){var d=this;this._img=$("<img />"),this._img.css("position","absolute"),0!=b||0!=c?(this._imgwidth=b,this._imgheight=c,this.setBounds(this.bounds)):(console.log("image was not preloaded"),this._img.load(function(){d._imgwidth=d._img.width(),d._imgheight=d._img.height(),d.setBounds(d.bounds)})),this._img.attr("src",a),this.node.append(this._img)},b.prototype.setBounds=function(b){if(a.prototype.setBounds.call(this,b),null!=this._img){var c=Math.min(b.width/this._imgwidth,b.height/this._imgheight);this._img.width(this._imgwidth*c),this._img.height(this._imgheight*c),this._img.css("left",(b.width-this._img.width())/2+b.x),this._img.css("top",(b.height-this._img.height())/2+b.y)}},b}(Command),SoundCommand=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.initialize=function(a,b){var c=this;void 0==a.id&&(a.id=""),void 0==a.loops&&(a.loops=1);var d=MediaLoader.getSound(a.id,function(a){return c.createElement(a)});null!=d&&(this._sound=d.audio,this._sound.play(),this.node.append(this._sound))},b.prototype.createElement=function(a){this._sound=new Audio(a),this._sound.play(),this.node.append(this._sound)},b.prototype.destroy=function(){this._sound&&!this._sound.paused&&this._sound.pause()},b}(InvisibleCommand),Mult=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b._elements=new Array,b}return __extends(b,a),b.prototype.initialize=function(b,c){a.prototype.initialize.call(this,b,c);for(var d=0;b["e"+d]instanceof CommandString;d++)this._elements[d]=b["e"+d].loadCmdClip(this.viewer,c),this.addChild(this._elements[d]);this.setBounds(c)},b.prototype.destroy=function(){for(var b in this._elements)this._elements[b].destroy();a.prototype.destroy.call(this)},b.prototype.setBounds=function(b){a.prototype.setBounds.call(this,b);var c=b;c.x=0,c.y=0;for(var d in this._elements)this._elements[d].setBounds(c)},b}(Command),Button=function(a){function b(b){var c=a.call(this)||this;return c.node=$("<button>"+b+"</button>"),c.node.css("position","absolute"),c}return __extends(b,a),b.prototype.addClickHandler=function(a){var b=this;this.node.click(function(c){return a(b)})},b}(Control),Go=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.initialize=function(b,c){var d=this;a.prototype.initialize.call(this,b,c),this._button=new Button("Continue"),this._button.addClickHandler(function(a){d.viewer.runAction(b.target)}),this.addChild(this._button),this.setBounds(this.bounds)},b.prototype.setBounds=function(b){var c=b.width-20;a.prototype.setBounds.call(this,b),this._button.y=10,this._button.width=c,this._button.height=25,this._button.x=b.width/2-this._button.width/2},b}(Command),Yn=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.initialize=function(b,c){var d=this;a.prototype.initialize.call(this,b,c),this._yesButton=new Button("YES"),this._yesButton.addClickHandler(function(a){d.viewer.runAction(b.yes.toString())}),this.addChild(this._yesButton),this._noButton=new Button("NO"),this._noButton.addClickHandler(function(a){d.viewer.runAction(b.no.toString())}),this.addChild(this._noButton),this.setBounds(this.bounds)},b.prototype.setBounds=function(b){var c=b.width-20;a.prototype.setBounds.call(this,b),this._yesButton.y=10,this._yesButton.width=c,this._yesButton.height=25,this._yesButton.x=b.width/2-this._yesButton.width/2,this._noButton.y=45,this._noButton.width=c,this._noButton.height=25,this._noButton.x=b.width/2-this._noButton.width/2},b}(Command),Horiz=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b._elements=new Array,b}
return __extends(b,a),b.prototype.initialize=function(b,c){a.prototype.initialize.call(this,b,c);for(var d=0;b["e"+d]instanceof CommandString;d++)this._elements[d]=b["e"+d].loadCmdClip(this.viewer,this.calculateElementBounds(c,d)),this.addChild(this._elements[d]);this.setBounds(c)},b.prototype.setBounds=function(b){a.prototype.setBounds.call(this,b);for(var c in this._elements)this._elements[c].setBounds(this.calculateElementBounds(b,Number(c)))},b.prototype.destroy=function(){for(var a in this._elements)this._elements[a].destroy()},b.prototype.calculateElementBounds=function(a,b){var c=a.width/this._elements.length;return{x:c*b,y:0,width:c,height:a.height}},b}(Command),Vert=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.calculateElementBounds=function(a,b){var c=a.height/this._elements.length;return{x:0,y:c*b,width:a.width,height:c}},b}(Horiz),Buttons=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b._buttonCaps=new Array,b._buttons=new Array,b}return __extends(b,a),b.prototype.initialize=function(b,c){a.prototype.initialize.call(this,b,c);for(var d=null,e=0;null!=b["target"+e];e++)d=b["cap"+e]?b["cap"+e]:e.toString(),this.addButton(e,b["target"+e],d);this.setBounds(c)},b.prototype.addButton=function(a,b,c){var d=this;this._buttons[a]=new Button(c),this._buttons[a].addClickHandler(function(a){d.viewer.runAction(b.toString())}),this.addChild(this._buttons[a])},b.prototype.calculateButtonBounds=function(a,b){var c=a.width-20;return{x:a.width/2-c/2,y:35*b,width:c,height:25}},b.prototype.setBounds=function(b){a.prototype.setBounds.call(this,b);for(var c in this._buttons){var d=this.calculateButtonBounds(b,Number(c));this._buttons[c].x=d.x,this._buttons[c].y=d.y,this._buttons[c].width=d.width,this._buttons[c].height=d.height}},b}(Command),SplitView=function(a){function b(){var b=a.call(this)||this;return b.node.addClass("splitView"),b}return __extends(b,a),b}(Command),Page=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.initialize=function(b,c){if(a.prototype.initialize.call(this,b,c),(b.instruc instanceof CommandString||b.action instanceof CommandString)&&(this._splitView=new SplitView,this.addChild(this._splitView),this.positionSidebar(c)),b.text instanceof CommandString)this._textClip=b.text.loadCmdClip(this.viewer,"text",this.calculateTextBounds(c)),this.addChild(this._textClip);else if("String"==b.text.constructor.name){var d=new CommandString("text(text:'"+b.text.split("'").join("\\'")+"')");this._textClip=d.loadCmdClip(this.viewer,this.calculateTextBounds(c)),this.addChild(this._textClip)}if(b.media instanceof CommandString&&(this._mediaClip=b.media.loadCmdClip(this.viewer,this.calculateMediaBounds(c)),this.addChild(this._mediaClip)),b.instruc instanceof CommandString&&(this._instrucClip=b.instruc.loadCmdClip(this.viewer,this.calculateInstrucBounds(c)),this.addChild(this._instrucClip)),b.action instanceof CommandString&&(this._actionClip=b.action.loadCmdClip(this.viewer,this.calculateActionBounds(c)),this.addChild(this._actionClip)),b.hidden instanceof CommandString&&(this._hiddenClip=b.hidden.loadCmdClip(this.viewer,{})),this.setBounds(c),null==this._splitView&&null==this._actionClip&&null==this._hiddenClip){this._splitView=new SplitView,this.addChild(this._splitView),this.positionSidebar(c);var e=new CommandString("buttons(target0:'exittease',cap0:'Exit Tease')");this._actionClip=e.loadCmdClip(this.viewer,this.calculateActionBounds(c)),this.addChild(this._actionClip)}},b.prototype.setBounds=function(b){null!=this._splitView&&this.positionSidebar(b),null!=this._textClip&&this._textClip.setBounds(this.calculateTextBounds(b)),null!=this._mediaClip&&this._mediaClip.setBounds(this.calculateMediaBounds(b)),null!=this._instrucClip&&this._instrucClip.setBounds(this.calculateInstrucBounds(b)),null!=this._actionClip&&this._actionClip.setBounds(this.calculateActionBounds(b)),a.prototype.setBounds.call(this,b)},b.prototype.destroy=function(){null!=this._hiddenClip&&(this._hiddenClip.destroy(),this._hiddenClip=null),a.prototype.destroy.call(this)},b.prototype.calculateTextBounds=function(a){var b=null!=this._splitView?Number(a.width-150):Number(a.width);return{x:a.x,y:a.y+.7*a.height,width:b,height:.3*a.height}},b.prototype.calculateInstrucBounds=function(a){return{x:a.x+a.width-150,y:a.y,width:150,height:.5*a.height}},b.prototype.calculateMediaBounds=function(a){var b=null!=this._splitView?Number(a.width-150):Number(a.width);return{x:a.x,y:a.y,width:b,height:.7*a.height}},b.prototype.calculateActionBounds=function(a){return{x:a.x+a.width-150,y:a.y+.5*a.height,width:150,height:.5*a.height}},b.prototype.positionSidebar=function(a){this._splitView.x=a.x+a.width-150,this._splitView.y=a.y,this._splitView.width=150,this._splitView.height=a.height},b}(Command),Parser=function(){function a(){}return a.explode=function(a,b){var c=NaN,d=null,e=new Array;if(null==a)return[];if(null==b)return[];for(var f=0;f<b.length&&(c=b.indexOf(a,f))!=-1;)d=b.slice(f,c),e.push(d),f=c+1;return e.length<1?e.push(b):e.push(b.slice(f,b.length)),e},a.explodeWithParenthesis=function(a,b){var c=null;if(null==b)return[];for(var d=new Array,e="",f="",g=0,h=0,i=0,j=0;j<b.length;j++){switch(e=b.charAt(j),g){case 0:"'"==e?g=1:'"'==e?g=2:"("==e?h++:")"==e?h--:e==a&&0==h&&(c=b.slice(i,j),d.push(c),i=j+1);break;case 1:"'"==e&&"\\"!=f&&(g=0);break;case 2:'"'==e&&"\\"!=f&&(g=0)}f=e}return d.length<1?d.push(b):d.push(b.slice(i,b.length)),d},a.parseParameter=function(b){return"'"==b.substr(0,1)||'"'==b.substr(0,1)?a.parseString(b):"#"==b.substr(-1)?new ActionString(b.substr(0,b.length-1)):"hrs"==b.substr(-3)||"min"==b.substr(-3)||"sec"==b.substr(-3)?a.parseTime(b):isNaN(parseInt(b))?b.indexOf("(")&&")"==b.substr(-1)?new CommandString(b):b:parseInt(b)},a.parseParamList=function(b){var c=null,d=null,e=NaN,f=null,g=null,h=a.explodeWithParenthesis(",",b),i=new Array;for(c in h)d=h[c],e=d.indexOf(":"),f=d.substr(0,e),g=d.substr(e+1),i[f]=a.parseParameter(g);return i},a.parseString=function(a){return a=a.substr(1,a.length-2),a=a.split("\\'").join("'")},a.parseTime=function(a){var b=a.substr(-3),c=parseInt(a.substr(0,a.length-3));return"hrs"==b?3600*c:"min"==b?60*c:c},a}(),Rating=function(){function a(a){this._target=a,this.render(),this._target.hide()}return a.prototype.show=function(){this._target.show(1)},a.prototype.render=function(){var a=$("<div></div>");a.append("<p>Please rate this tease.</p>");for(var b=this,c=1;c<=5;c++){var d=$('<img src="images/ustar.png" data-id="'+c+'" title="'+c+" Star"+(c>1?"s":"")+'" />');d.mouseenter(function(c){b.highlight(a,Number($(c.target).attr("data-id")),!0)}),d.mouseout(function(c){b.highlight(a,Number($(c.target).attr("data-id")),!1)}),d.click(function(a){b.submit(Number($(a.target).attr("data-id")))}),a.append(d)}a.append('<p><a href="/">Go Back.</a></p>'),this._target.append(a)},a.prototype.highlight=function(a,b,c){for(var d=a.find("img"),e=0;e<b;e++)$(d[e]).attr("src",c?"images/star.png":"images/ustar.png")},a.prototype.submit=function(a){$.ajax({url:"vote?id="+Settings.get("teaseId")+"&vote="+a,type:"GET",success:function(a){location.href="/"}})},a}();$().ready(function(){return runTease(Number(getQueryVariable("id")),Number(getQueryVariable("resume")))});