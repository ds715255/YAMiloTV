function checkAddTease(){var a=$("#teaseurltb").val().toString();null==Tease.getIdFromUrl(a)?$("#addtease").prop("disabled",!0):$("#addtease").prop("disabled",!1)}var teaseManager,settingsManager,__awaiter=this&&this.__awaiter||function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})},__generator=this&&this.__generator||function(a,b){function c(a){return function(b){return d([a,b])}}function d(c){if(e)throw new TypeError("Generator is already executing.");for(;i;)try{if(e=1,f&&(g=f[2&c[0]?"return":c[0]?"throw":"next"])&&!(g=g.call(f,c[1])).done)return g;switch(f=0,g&&(c=[0,g.value]),c[0]){case 0:case 1:g=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,f=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(g=i.trys,!(g=g.length>0&&g[g.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!g||c[1]>g[0]&&c[1]<g[3])){i.label=c[1];break}if(6===c[0]&&i.label<g[1]){i.label=g[1],g=c;break}if(g&&i.label<g[2]){i.label=g[2],i.ops.push(c);break}g[2]&&i.ops.pop(),i.trys.pop();continue}c=b.call(a,i)}catch(a){c=[6,a],f=0}finally{e=g=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}var e,f,g,h,i={label:0,sent:function(){if(1&g[0])throw g[1];return g[1]},trys:[],ops:[]};return h={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h},Tease=function(){function a(a){this._id=a}return a.fromObject=function(b){var c=new a(b._id);return c._author=b._author,c._title=b._title,c._thumbnail=b._thumbnail,window.localStorage.getItem("tease-"+b._id)&&(c._hasSaveState=!0),c},a.getIdFromUrl=function(a){var b=/https:\/\/milovana\.com\/webteases\/showflash.php\?id=(\d+)/g,c=b.exec(a);return null==c?null:Number(c[1])},Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),a.prototype.loadMeta=function(){return __awaiter(this,void 0,void 0,function(){var a=this;return __generator(this,function(b){return[2,new Promise(function(b,c){return jQuery.get("meta?id="+a._id,function(c){console.log("downloaded metadata successfully");var d=c.split("\n");a._title=d[1],a._author=d[2],a._thumbnail=d[3],b(!0)})})]})})},a.prototype.render=function(a){var b=this,c=$('<tr><td><img src="'+this._thumbnail+'" /></td><td><h3>'+this._title+"</h3></td><td><button>Start</button><button>Continue</button><button>Delete</button></td></tr>");a.append(c);var d=c.find("button");$(d[0]).click(function(){b._hasSaveState&&!confirm("Starting this tease will delete your saved state. Do you really want to start over?")||(location.href="tease?id="+b._id+"&skin="+settingsManager.get("skin"))}),this._hasSaveState?$(d[1]).click(function(){location.href="tease?id="+b._id+"&skin="+settingsManager.get("skin")+"&resume=1"}):$(d[1]).css("display","none"),$(d[2]).click(function(){confirm("Do you really want to delete the Tease '"+b._title+"'?")&&teaseManager.remove(b._id)})},a}(),TeaseManager=function(){function a(a){this._target=a,this.load(),this.render()}return a.prototype.add=function(a){return __awaiter(this,void 0,void 0,function(){var b;return __generator(this,function(c){switch(c.label){case 0:return null==a?[2]:this.containsTease(a)?(alert("This Tease has already been added to your Tease List."),[2]):(b=new Tease(a),[4,b.loadMeta()]);case 1:return c.sent()&&(this._teases.splice(0,0,b),this.save(),this.render()),[2]}})})},a.prototype.containsTease=function(a){for(var b in this._teases)if(this._teases[b].id==a)return!0;return!1},a.prototype.render=function(){if(this._target.children().remove(),this._teases.length>0)for(var a in this._teases)this._teases[a].render(this._target);else this._target.html('<tr><td colspan="3"><p style="margin:5px">No teases added yet.</p></td></tr>')},a.prototype.clear=function(){this._teases=[],this.save()},a.prototype.remove=function(a){this._teases=$.grep(this._teases,function(b){return b.id!=a}),window.localStorage.removeItem("tease-"+a),this.save(),this.render()},a.prototype.load=function(){var a=window.localStorage.getItem("teases");if(this._teases=[],null!=a){var b=JSON.parse(a);for(var c in b)this._teases.push(Tease.fromObject(b[c]))}},a.prototype.save=function(){window.localStorage.setItem("teases",JSON.stringify(this._teases))},a}(),SettingsManager=function(){function a(){}return a.prototype.registerSwitchGroup=function(a,b){var c=this;a.change(function(a){c.saveSetting(b,$(a.target).val())});var d=a.filter("input[checked='checked']");d=0==d.length?$(a[0]):d;var e=this.loadSetting(b,d.val());a.filter("input[value='"+e+"']").click()},a.prototype.get=function(a){return this.loadSetting(a,null)},a.prototype.saveSetting=function(a,b){window.localStorage.setItem("setting-"+a,JSON.stringify(b))},a.prototype.loadSetting=function(a,b){var c=window.localStorage.getItem("setting-"+a);return null==c?b:JSON.parse(c)},a}();$(document).ready(function(){var a=this;/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||$(".ios").remove(),teaseManager=new TeaseManager($("#teases")),settingsManager=new SettingsManager,settingsManager.registerSwitchGroup($("input[name='settings-skin']"),"skin"),$("#teaseurltb").change(function(a){checkAddTease()}),$("#teaseurltb").keyup(function(a){checkAddTease()}),$("#addtease").click(function(){return __awaiter(a,void 0,void 0,function(){return __generator(this,function(a){switch(a.label){case 0:return[4,teaseManager.add(Tease.getIdFromUrl($("#teaseurltb").val().toString()))];case 1:return a.sent(),$("#teaseurltb").val(""),[2]}})})}),checkAddTease()});