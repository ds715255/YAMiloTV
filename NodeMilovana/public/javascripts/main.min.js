function checkAddTease(){var a=$("#teaseurltb").val().toString();null==Tease.getIdFromUrl(a)?$("#addtease").prop("disabled",!0):$("#addtease").prop("disabled",!1)}var teaseManager,settingsManager,__awaiter=this&&this.__awaiter||function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})};class Tease{constructor(a){this._id=a}static fromObject(a){var b=new Tease(a._id);return b._author=a._author,b._title=a._title,b._thumbnail=a._thumbnail,window.localStorage.getItem(`tease-${a._id}`)&&(b._hasSaveState=!0),b}static getIdFromUrl(a){var b=/https:\/\/milovana\.com\/webteases\/showflash.php\?id=(\d+)/g,c=b.exec(a);return null==c?null:Number(c[1])}get id(){return this._id}loadMeta(){return __awaiter(this,void 0,void 0,function*(){return new Promise((a,b)=>jQuery.get("meta?id="+this._id,b=>{console.log("downloaded metadata successfully");var c=b.split("\n");this._title=c[1],this._author=c[2],this._thumbnail=c[3],a(!0)}))})}render(a){var b=$(`<tr><td><img src="${this._thumbnail}" /></td><td><h3>${this._title}</h3></td><td><button>Start</button><button>Continue</button><button>Delete</button></td></tr>`);a.append(b);var c=b.find("button");$(c[0]).click(()=>{this._hasSaveState&&!confirm("Starting this tease will delete your saved state. Do you really want to start over?")||(location.href=`tease?id=${this._id}&skin=${settingsManager.get("skin")}`)}),this._hasSaveState?$(c[1]).click(()=>{location.href=`tease?id=${this._id}&skin=${settingsManager.get("skin")}&resume=1`}):$(c[1]).css("display","none"),$(c[2]).click(()=>{confirm(`Do you really want to delete the Tease '${this._title}'?`)&&teaseManager.remove(this._id)})}}class TeaseManager{constructor(a){this._target=a,this.load(),this.render()}add(a){return __awaiter(this,void 0,void 0,function*(){if(null!=a){if(this.containsTease(a))return void alert("This Tease has already been added to your Tease List.");var b=new Tease(a);(yield b.loadMeta())&&(this._teases.splice(0,0,b),this.save(),this.render())}})}containsTease(a){for(var b in this._teases)if(this._teases[b].id==a)return!0;return!1}render(){if(this._target.children().remove(),this._teases.length>0)for(var a in this._teases)this._teases[a].render(this._target);else this._target.html('<tr><td colspan="3"><p style="margin:5px">No teases added yet.</p></td></tr>')}clear(){this._teases=[],this.save()}remove(a){this._teases=$.grep(this._teases,function(b){return b.id!=a}),window.localStorage.removeItem(`tease-${a}`),this.save(),this.render()}load(){var a=window.localStorage.getItem("teases");if(this._teases=[],null!=a){var b=JSON.parse(a);for(var c in b)this._teases.push(Tease.fromObject(b[c]))}}save(){window.localStorage.setItem("teases",JSON.stringify(this._teases))}}class SettingsManager{registerSwitchGroup(a,b){var c=this;a.change(function(a){c.saveSetting(b,$(a.target).val())});var d=a.filter("input[checked='checked']");d=0==d.length?$(a[0]):d;var e=this.loadSetting(b,d.val());a.filter(`input[value='${e}']`).click()}get(a){return this.loadSetting(a,null)}saveSetting(a,b){window.localStorage.setItem(`setting-${a}`,JSON.stringify(b))}loadSetting(a,b){var c=window.localStorage.getItem(`setting-${a}`);return null==c?b:JSON.parse(c)}}$(document).ready(function(){/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||$(".ios").remove(),teaseManager=new TeaseManager($("#teases")),settingsManager=new SettingsManager,settingsManager.registerSwitchGroup($("input[name='settings-skin']"),"skin"),$("#teaseurltb").change(a=>{checkAddTease()}),$("#teaseurltb").keyup(a=>{checkAddTease()}),$("#addtease").click(()=>__awaiter(this,void 0,void 0,function*(){yield teaseManager.add(Tease.getIdFromUrl($("#teaseurltb").val().toString())),$("#teaseurltb").val("")})),checkAddTease()});