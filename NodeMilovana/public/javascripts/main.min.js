function checkAddTease(){var b=$("#teaseurltb").val(),c=a.getIdFromUrl(b);null==c?$("#addtease").prop("disabled",!0):$("#addtease").prop("disabled",!1)}var teaseManager,__awaiter=this&&this.__awaiter||function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b)).next())})};class a{constructor(a){this._id=a}static fromObject(b){var c=new a(b._id);return c._author=b._author,c._title=b._title,c._thumbnail=b._thumbnail,c}static getIdFromUrl(a){var b=/https:\/\/milovana\.com\/webteases\/showflash.php\?id=(\d+)/g,c=b.exec(a);return null==c?null:Number(c[1])}get id(){return this._id}loadMeta(){return __awaiter(this,void 0,void 0,function*(){return new Promise((a,b)=>jQuery.get("meta?id="+this._id,b=>{console.log("downloaded metadata successfully");var c=b.split("\n");this._title=c[1],this._author=c[2];var d,e=3;do d=c[e++].split(":")[1];while("*.jpg"==d);this._thumbnail=`https://eu.media.milovana.com/timg/${c[0]}/${this._id}/tb_s/${d}`,a(!0)}))})}render(a){var b=$(`<tr><td><img src="${this._thumbnail}" /></td><td><h3>${this._title}</h3></td><td><button>Start</button><button>Continue</button><button>Delete</button></td></tr>`);a.append(b);var c=b.find("button");$(c[0]).click(()=>{location.href=`tease?id=${this._id}`}),$(c[1]).css("display","none"),$(c[2]).click(()=>{confirm(`Do you really want to delete the Tease '${this._title}'?`)&&teaseManager.remove(this._id)})}}class b{constructor(a){this._target=a,this.load(),this.render()}add(b){return __awaiter(this,void 0,void 0,function*(){if(null!=b){if(this.containsTease(b))return void alert("This Tease has already been added to your Tease List.");var c=new a(b);(yield c.loadMeta())&&(this._teases.splice(0,0,c),this.save(),this.render())}})}containsTease(a){for(var b in this._teases)if(this._teases[b].id==a)return!0;return!1}render(){if(this._target.children().remove(),this._teases.length>0)for(var a in this._teases)this._teases[a].render(this._target);else this._target.html('<tr><td colspan="3"><p style="margin:5px">No teases added yet.</p></td></tr>')}clear(){this._teases=[],this.save()}remove(a){this._teases=$.grep(this._teases,function(b){return b.id!=a}),this.save(),this.render()}load(){var b=window.localStorage.getItem("teases");if(this._teases=[],null!=b){var c=JSON.parse(b);for(var d in c)this._teases.push(a.fromObject(c[d]))}}save(){window.localStorage.setItem("teases",JSON.stringify(this._teases))}}$(document).ready(function(){var c=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;c||$(".ios").remove(),teaseManager=new b($("#teases")),$("#teaseurltb").change(a=>{checkAddTease()}),$("#teaseurltb").keyup(a=>{checkAddTease()}),$("#addtease").click(()=>__awaiter(this,void 0,void 0,function*(){yield teaseManager.add(a.getIdFromUrl($("#teaseurltb").val())),$("#teaseurltb").val("")})),checkAddTease()});